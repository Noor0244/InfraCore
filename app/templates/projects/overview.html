{% extends "base.html" %}

{% block content %}

<div class="page-title" style="font-size:2.2rem;font-weight:700;margin-bottom:18px;letter-spacing:0.5px;display:flex;align-items:center;gap:18px;">
    <span style="color:#4fc3f7;">&#9679;</span>
    <span>Project Overview</span>
    <span style="font-size:1.2rem;font-weight:400;color:#aaa;">— {{ project.name }}</span>
</div>

<div class="card" style="max-width: 1100px; box-shadow:0 2px 12px 0 rgba(0,0,0,0.07); margin-bottom: 24px;">
    <h3 style="margin-bottom:10px;font-size:1.25rem;font-weight:600;color:#2196f3;">Project Modules</h3>
    <div style="display: flex; gap: 16px; flex-wrap: wrap; margin-bottom: 8px;">
        <a href="/projects/{{ project.id }}/design-data" class="btn btn-primary">Design Data</a>
        <!-- Activities button removed as requested -->
        <!-- Materials and Activity → Material Map buttons removed as requested -->
        <a href="/project/{{ project.id }}/materials" class="btn btn-primary">Material & Vendor</a>
        <!-- Documents button removed as requested -->
    </div>
    <p style="margin-top: 10px; color: #888; font-size:0.98rem;">
        Complete project information step-by-step using the modules above.
    </p>
</div>

<div class="card" style="max-width: 1100px; margin-bottom: 24px; box-shadow:0 2px 12px 0 rgba(0,0,0,0.07);">
    <h3 style="margin-bottom:10px;font-size:1.25rem;font-weight:600;color:#2196f3;">Basic Information</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:0 32px;">
        <div><b>Project Name:</b> <span style="color:#fff">{{ project.name }}</span></div>
        <div><b>Project Code:</b> <span style="color:#fff">{{ project.project_code or "-" }}</span></div>
        <div><b>Client / Authority:</b> <span style="color:#fff">{{ project.client_authority or "-" }}</span></div>
        <div><b>Contractor:</b> <span style="color:#fff">{{ project.contractor or "-" }}</span></div>
        <div><b>Consultant / PMC:</b> <span style="color:#fff">{{ project.consultant_pmc or "-" }}</span></div>
    </div>
</div>

<div class="card" style="max-width: 1100px; margin-bottom: 24px; box-shadow:0 2px 12px 0 rgba(0,0,0,0.07);">
    <h3 style="margin-bottom:10px;font-size:1.25rem;font-weight:600;color:#2196f3;">Road & Location Details</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:0 32px;">
        <div><b>Road Type:</b> <span style="color:#fff">{{ project.road_type }}</span></div>
        <div><b>Lanes:</b> <span style="color:#fff">{{ project.lanes }}</span></div>
        <div><b>Road Length (km):</b> <span style="color:#fff">{{ project.road_length_km }}</span></div>
        <div><b>Chainage:</b> <span style="color:#fff">{{ project.chainage_start or "N/A" }} — {{ project.chainage_end or "N/A" }}</span></div>
        <div style="grid-column:1/-1"><b>Location:</b> <span style="color:#fff">{{ project.city }}{% if project.district %}, {{ project.district }}{% endif %}{% if project.state %}, {{ project.state }}{% endif %}, {{ project.country }}</span></div>
    </div>
</div>

{% if project.project_type|lower == "road" %}
<div class="card" style="max-width: 1100px; margin-bottom: 20px;">
    <h3>Road Preset Snapshot (Read-only)</h3>

    <div style="display:flex; justify-content: flex-end; gap: 10px; margin: 6px 0 12px;">
        <a class="btn" href="/projects/{{ project.id }}/preset-snapshot.json" download>
            Download Snapshot (JSON)
        </a>
    </div>

    <table class="table">
        <tr>
            <th>Road Category</th>
            <td>{{ project.road_category or "-" }}</td>
        </tr>
        <tr>
            <th>Road Engineering Type</th>
            <td>{{ project.road_engineering_type or "-" }}</td>
        </tr>
        <tr>
            <th>Preset Key</th>
            <td>{{ preset_snapshot.preset_key or "-" }}</td>
        </tr>
        <tr>
            <th>Selected Activities</th>
            <td>
                {% if preset_snapshot.activity_names %}
                    {{ preset_snapshot.activity_names|length }} activities
                    <details style="margin-top: 6px;">
                        <summary style="cursor: pointer;">Show list</summary>
                        <div style="max-height: 240px; overflow: auto; margin-top: 8px;">
                            <ol style="margin: 0 0 0 18px;">
                                {% for a in preset_snapshot.activity_names %}
                                    <li>{{ a }}</li>
                                {% endfor %}
                            </ol>
                        </div>
                    </details>
                {% else %}
                    -
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>Selected Materials</th>
            <td>
                {% if preset_snapshot.material_defs %}
                    {{ preset_snapshot.material_defs|length }} materials
                    <details style="margin-top: 6px;">
                        <summary style="cursor: pointer;">Show list</summary>
                        <div style="max-height: 240px; overflow: auto; margin-top: 8px;">
                            <ol style="margin: 0 0 0 18px;">
                                {% for m in preset_snapshot.material_defs %}
                                    <li>{{ m.name }} <span style="color:#666;">({{ m.unit }})</span></li>
                                {% endfor %}
                            </ol>
                        </div>
                    </details>
                {% else %}
                    -
                {% endif %}
            </td>
        </tr>
    </table>

    {% if preset_snapshot.mapping_by_activity %}
        <h4 style="margin-top: 10px;">Activity → Material Map (Preset Codes)</h4>
        <table class="table">
            <tr>
                <th style="width: 220px;">Activity Code</th>
                <th>Material Codes</th>
            </tr>
            {% for act_code, mat_codes in preset_snapshot.mapping_by_activity.items() %}
                <tr>
                    <td><code>{{ act_code }}</code></td>
                    <td>
                        {% if mat_codes %}
                            {% for mc in mat_codes %}
                                <code style="margin-right: 6px;">{{ mc }}</code>
                            {% endfor %}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>
        <p style="margin-top: 8px; color: #666;">
            This snapshot is stored at create-time for traceability and admin safety checks.
        </p>
    {% endif %}
</div>
{% endif %}

<div class="card" style="max-width: 1100px; margin-bottom: 24px; box-shadow:0 2px 12px 0 rgba(0,0,0,0.07);">
    <h3 style="margin-bottom:10px;font-size:1.25rem;font-weight:600;color:#2196f3;">Planned Timeline</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:0 32px;">
        <div><b>Planned Start Date:</b> <span style="color:#fff">{{ project.planned_start_date|ddmmyyyy }}</span></div>
        <div><b>Planned End Date:</b> <span style="color:#fff">{{ project.planned_end_date|ddmmyyyy }}</span></div>
        <div><b>Status:</b> <span style="color:#fff">{{ project.status|capitalize }}</span></div>
    </div>
</div>



{% endblock %}
