{% extends "base.html" %}
{% block content %}

<!-- ================= PAGE HEADER ================= -->
<div class="page-header"
     style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px">

    <div>
        <h1 class="page-title">
            Projects
            {% if show == "archived" %}<span style="opacity:0.7;font-size:0.85em">(Archived View)</span>{% endif %}
        </h1>
        <p style="opacity:0.7;margin-top:4px">
            {% if show == "archived" %}
            View and restore archived projects. Click 'Restore' to unarchive.
            {% else %}
            Create, edit, and manage active projects. Click 'Archive' to hide from this view.
            {% endif %}
        </p>
    </div>

    <!-- VIEW TOGGLES -->
    <div style="display:flex;gap:10px;flex-wrap:wrap">
        <a href="?show=active" class="btn-toggle" style="{% if show == 'active' %}background:#2563eb;color:#fff{% else %}opacity:0.6{% endif %}">
            ‚úÖ Active
        </a>
        <a href="?show=archived" class="btn-toggle" style="{% if show == 'archived' %}background:#f59e0b;color:#fff{% else %}opacity:0.6{% endif %}">
            üì¶ Archived
        </a>
        {% if user["role"] in ["admin", "superadmin", "manager"] and show == "active" %}
        <a href="/projects/new" class="btn-primary">
            ‚ûï Create New Project
        </a>
        {% endif %}
    </div>
</div>

<!-- ================= PROJECT LIST ================= -->

<style>
    .projects-card {
        background: var(--card-bg);
        border-radius: 18px;
        box-shadow: 0 2px 16px 0 rgba(0,0,0,0.10);
        padding: 0 0 18px 0;
        margin-bottom: 32px;
        overflow-x: auto;
    }
    .projects-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 15px;
        background: none;
    }
    .projects-table th, .projects-table td {
        padding: 14px 16px;
        text-align: left;
    }
    .projects-table th {
        background: rgba(0,0,0,0.03);
        font-weight: 600;
        letter-spacing: 0.02em;
        color: var(--text-secondary);
        border-bottom: 2px solid var(--border-color);
    }
    .projects-table tr {
        transition: background 0.18s;
        color: var(--text-primary);
    }
    .projects-table tbody tr:hover {
        background: rgba(59,130,246,0.07);
    }
    .projects-table tbody tr:nth-child(even) {
        background: rgba(0,0,0,0.02);
    }
    .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 999px;
        font-size: 13px;
        font-weight: 500;
        letter-spacing: 0.01em;
        vertical-align: middle;
    }
    .badge-success { background: #dcfce7; color: #166534; }
    .badge-danger { background: #fee2e2; color: #991b1b; }
    .badge-archived { background: #fed7aa; color: #92400e; }
    .badge-info { background: #dbeafe; color: #0c4a6e; }
    .btn-sm { font-size: 13px; padding: 6px 12px; border-radius: 7px; cursor: pointer; border: none; transition: all 0.18s; }
    .btn-primary { background: #2563eb; color: #fff; border: none; cursor: pointer; border-radius: 8px; padding: 8px 16px; font-weight: 600; transition: all 0.18s; }
    .btn-secondary { background: #e5e7eb; color: #111827; border: none; }
    .btn-info { background: #3b82f6; color: #fff; border: none; }
    .btn-warning { background: #fbbf24; color: #111827; border: none; }
    .btn-danger { background: #ef4444; color: #fff; border: none; }
    .btn-toggle { padding: 8px 14px; border-radius: 8px; border: 1px solid rgba(148,163,184,0.2); cursor: pointer; font-weight: 500; transition: all 0.2s; text-decoration: none; display: inline-block; }
    .btn-sm:hover, .btn-primary:hover, .btn-secondary:hover, .btn-info:hover, .btn-warning:hover, .btn-danger:hover, .btn-toggle:hover {
        filter: brightness(1.08);
        box-shadow: 0 2px 8px 0 rgba(59,130,246,0.08);
    }
    .dark .badge-success { background: #16a34a22; color: #86efac; }
    .dark .badge-danger { background: #dc262622; color: #fca5a5; }
    .dark .badge-archived { background: #d9792622; color: #fed7aa; }
    .dark .badge-info { background: #0c2a4722; color: #60a5fa; }
    .dark .btn-secondary { background: #374151; color: #e5e7eb; }
    .dark .btn-warning { background: #d97706; color: #fff; }
    .dark .btn-toggle { border-color: rgba(148,163,184,0.3); }

    /* Light Mode */
    html:not(.dark) .projects-card {
        background: #ffffff;
        box-shadow: 0 2px 8px rgba(15,23,42,0.08);
    }

    html:not(.dark) .projects-table th {
        background: #f8fafc;
        color: #0f172a;
        border-bottom-color: #e2e8f0;
    }

    html:not(.dark) .projects-table tbody tr:hover {
        background: rgba(59,130,246,0.05);
    }

    html:not(.dark) .projects-table tbody tr:nth-child(even) {
        background: #f8fafc;
    }

    html:not(.dark) .projects-table th,
    html:not(.dark) .projects-table td {
        color: #1e293b;
        border-bottom-color: #e2e8f0;
    }

    html:not(.dark) .badge-success { background: #dcfce7; color: #166534; }
    html:not(.dark) .badge-danger { background: #fee2e2; color: #991b1b; }
    html:not(.dark) .badge-archived { background: #fed7aa; color: #92400e; }
    html:not(.dark) .badge-info { background: #dbeafe; color: #0c4a6e; }

    html:not(.dark) .btn-secondary { background: #e5e7eb; color: #111827; }
    html:not(.dark) .btn-toggle { border-color: #e2e8f0; }
    html:not(.dark) .btn-toggle:hover { background: #f1f5f9; }

    @media (max-width: 900px) {
        .projects-table th, .projects-table td { padding: 10px 8px; }
        .projects-card { padding: 0 0 8px 0; }
    }
</style>

<div class="projects-card">

    {% if projects %}
    <table class="projects-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Project Name</th>
                <th>Road Type</th>
                <th>City</th>
                <th>Country</th>
                <th>Start</th>
                <th>End</th>
                <th>Status</th>
                <th style="min-width:220px">Actions</th>
            </tr>
        </thead>

        <tbody>
        {% for project in projects %}
            <tr>
                <td>{{ project.id }}</td>
                <td><strong>{{ project.name }}</strong></td>
                <td>{{ project.road_type }}</td>
                <td>{{ project.city }}</td>
                <td>{{ project.country }}</td>
                <td>{{ project.planned_start_date|ddmmyyyy }}</td>
                <td>{{ project.planned_end_date|ddmmyyyy }}</td>
                <td>
                    {% if project.is_active %}
                        <span class="badge badge-success" title="Active">‚óè Active</span>
                    {% else %}
                        <span class="badge badge-archived" title="Archived">üì¶ Archived</span>
                    {% endif %}
                </td>
                <td style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
                    {% if user["role"] in ["admin", "superadmin", "manager"] %}
                    {% if show != "archived" %}
                    <a href="/projects/{{ project.id }}/edit" class="btn-secondary btn-sm" title="Edit Project">
                        ‚úèÔ∏è Edit
                    </a>
                    {% endif %}
                    {% endif %}
                    <a href="/projects/{{ project.id }}" class="btn-info btn-sm" title="Project Details">
                        üìÑ Details
                    </a>
                    {% if user["role"] in ["admin", "superadmin", "manager"] %}
                    <form method="post" action="/projects/{{ project.id }}/archive" style="display:inline" onsubmit="return confirm('{% if project.is_active %}Archive this project? It will be hidden from active lists but can be restored later.{% else %}Restore this project to active status?{% endif %}')">
                        <button class="btn-warning btn-sm" type="submit" title="{% if project.is_active %}Archive{% else %}Restore{% endif %}">
                            {% if project.is_active %}üì¶ Archive{% else %}‚ôªÔ∏è Restore{% endif %}
                        </button>
                    </form>
                    {% endif %}
                    {% if show != "archived" and user["role"] in ["admin", "superadmin"] %}
                    <form method="post" action="/projects/{{ project.id }}/delete" style="display:inline" onsubmit="return confirm('Delete this project permanently? This cannot be undone.')">
                        <button class="btn-danger btn-sm" type="submit" title="Delete Project">
                            üóë Delete
                        </button>
                    </form>
                    {% endif %}
                    {% if user["role"] not in ["admin", "superadmin", "manager"] %}
                        <span class="badge badge-info" title="View Only">üëÅ View Only</span>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% else %}
    <!-- ================= EMPTY STATE ================= -->
    <div style="text-align:center;padding:48px">
        {% if show == "archived" %}
        <h3>No archived projects</h3>
        <p style="opacity:0.7;margin:8px 0 20px">
            You have no archived projects yet. Archive active projects to keep your workspace clean.
        </p>
        <a href="?show=active" class="btn-primary">
            ‚Üê View Active Projects
        </a>
        {% else %}
        <h3>No active projects</h3>
        <p style="opacity:0.7;margin:8px 0 20px">
            Create your first project to start planning and tracking progress.
        </p>

        {% if user["role"] in ["admin", "superadmin", "manager"] %}
        <a href="/projects/new" class="btn-primary">
            ‚ûï Create New Project
        </a>
        {% else %}
        <span class="badge badge-info">You don't have permission to create projects</span>
        {% endif %}
        {% endif %}
    </div>
    {% endif %}

</div>

{% endblock %}
