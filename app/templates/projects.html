{% extends "base.html" %}
{% block content %}

<!-- ================= PAGE HEADER ================= -->
<div class="page-header"
     style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px">

    <div>
        <h1 class="page-title">Projects</h1>
        <p style="opacity:0.7;margin-top:4px">
            Manage all projects: create, edit, archive, or delete
        </p>
    </div>

    <!-- ‚ûï CREATE PROJECT (ADMIN + MANAGER ONLY) -->
    {% if user["role"] in ["admin", "superadmin", "manager"] %}
    <div style="display:flex;gap:10px">
        <a href="/projects/new" class="btn-primary">
            ‚ûï Create New Project
        </a>
    </div>
    {% endif %}
</div>

<!-- ================= PROJECT LIST ================= -->

<style>
    .projects-card {
        background: var(--card-bg);
        border-radius: 18px;
        box-shadow: 0 2px 16px 0 rgba(0,0,0,0.10);
        padding: 0 0 18px 0;
        margin-bottom: 32px;
        overflow-x: auto;
    }
    .projects-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 15px;
        background: none;
    }
    .projects-table th, .projects-table td {
        padding: 14px 16px;
        text-align: left;
    }
    .projects-table th {
        background: rgba(0,0,0,0.03);
        font-weight: 600;
        letter-spacing: 0.02em;
        color: var(--text-secondary);
        border-bottom: 2px solid var(--border-color);
    }
    .projects-table tr {
        transition: background 0.18s;
        color: var(--text-primary);
    }
    .projects-table tbody tr:hover {
        background: rgba(59,130,246,0.07);
    }
    .projects-table tbody tr:nth-child(even) {
        background: rgba(0,0,0,0.02);
    }
    .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 999px;
        font-size: 13px;
        font-weight: 500;
        letter-spacing: 0.01em;
        vertical-align: middle;
    }
    .badge-success { background: #dcfce7; color: #166534; }
    .badge-danger { background: #fee2e2; color: #991b1b; }
    .badge-info { background: #dbeafe; color: #0c4a6e; }
    .btn-sm { font-size: 13px; padding: 6px 12px; border-radius: 7px; }
    .btn-primary { background: #2563eb; color: #fff; border: none; }
    .btn-secondary { background: #e5e7eb; color: #111827; border: none; }
    .btn-info { background: #3b82f6; color: #fff; border: none; }
    .btn-warning { background: #fbbf24; color: #111827; border: none; }
    .btn-danger { background: #ef4444; color: #fff; border: none; }
    .btn-sm:hover, .btn-primary:hover, .btn-secondary:hover, .btn-info:hover, .btn-warning:hover, .btn-danger:hover {
        filter: brightness(1.08);
        box-shadow: 0 2px 8px 0 rgba(59,130,246,0.08);
    }
    .dark .badge-success { background: #16a34a22; color: #86efac; }
    .dark .badge-danger { background: #dc262622; color: #fca5a5; }
    .dark .badge-info { background: #0c2a4722; color: #60a5fa; }
    .dark .btn-secondary { background: #374151; color: #e5e7eb; }
    .dark .btn-warning { background: #d97706; color: #fff; }
    @media (max-width: 900px) {
        .projects-table th, .projects-table td { padding: 10px 8px; }
        .projects-card { padding: 0 0 8px 0; }
    }
</style>

<div class="projects-card">

    {% if projects %}
    <table class="projects-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Project Name</th>
                <th>Road Type</th>
                <th>City</th>
                <th>Country</th>
                <th>Start</th>
                <th>End</th>
                <th>Status</th>
                <th style="min-width:220px">Actions</th>
            </tr>
        </thead>

        <tbody>
        {% for project in projects %}
            <tr>
                <td>{{ project.id }}</td>
                <td><strong>{{ project.name }}</strong></td>
                <td>{{ project.road_type }}</td>
                <td>{{ project.city }}</td>
                <td>{{ project.country }}</td>
                <td>{{ project.planned_start_date|ddmmyyyy }}</td>
                <td>{{ project.planned_end_date|ddmmyyyy }}</td>
                <td>
                    {% if project.is_active %}
                        <span class="badge badge-success" title="Active">‚óè Active</span>
                    {% else %}
                        <span class="badge badge-danger" title="Archived">‚è∏ Archived</span>
                    {% endif %}
                </td>
                <td style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
                    {% if user["role"] in ["admin", "superadmin", "manager"] %}
                    <a href="/projects/{{ project.id }}/edit" class="btn-secondary btn-sm" title="Edit Project">
                        <span style="font-size:15px">‚úèÔ∏è</span>
                    </a>
                    {% endif %}
                    <a href="/projects/{{ project.id }}" class="btn-info btn-sm" title="Project Details">
                        <span style="font-size:15px">üìÑ</span>
                    </a>
                    {% if user["role"] in ["admin", "superadmin", "manager"] %}
                    <form method="post" action="/projects/{{ project.id }}/archive" style="display:inline" onsubmit="return confirm('Archive this project? It will be hidden from active lists but can be restored later.')">
                        <button class="btn-warning btn-sm" type="submit" title="Archive or Restore">
                            {% if project.is_active %}üì¶{% else %}‚ôª{% endif %}
                        </button>
                    </form>
                    {% endif %}
                    {% if user["role"] in ["admin", "superadmin"] %}
                    <form method="post" action="/projects/{{ project.id }}/delete" style="display:inline" onsubmit="return confirm('Delete this project permanently? This cannot be undone.')">
                        <button class="btn-danger btn-sm" type="submit" title="Delete Project">
                            üóë
                        </button>
                    </form>
                    {% endif %}
                    {% if user["role"] not in ["admin", "superadmin", "manager"] %}
                        <span class="badge badge-info" title="View Only">üëÅ View Only</span>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% else %}
    <!-- ================= EMPTY STATE ================= -->
    <div style="text-align:center;padding:48px">
        <h3>No projects found</h3>
        <p style="opacity:0.7;margin:8px 0 20px">
            Create your first project to start planning and tracking progress.
        </p>

        {% if user["role"] in ["admin", "superadmin", "manager"] %}
        <a href="/projects/new" class="btn-primary">
            ‚ûï Create Project
        </a>
        {% else %}
        <span class="badge badge-info">No access to create projects</span>
        {% endif %}
    </div>
    {% endif %}

</div>

{% endblock %}
