{% extends "base.html" %}
{% block content %}

<style>
  .add-vendor-page { max-width: 1200px; margin: 0 auto; }
  .add-vendor-card { background: rgba(7,14,30,0.92); border: 1px solid rgba(148,163,184,0.22); border-radius: 16px; box-shadow: 0 14px 34px rgba(2,6,23,0.4); }
  .add-vendor-toolbar { background: linear-gradient(135deg, rgba(15,23,42,0.92), rgba(8,15,28,0.85)); border: 1px solid rgba(148,163,184,0.2); border-radius: 14px; padding: 12px 14px; }

  .add-vendor-page input,
  .add-vendor-page select,
  .add-vendor-page textarea {
    background: rgba(2,6,23,0.6);
    border: 1px solid rgba(148,163,184,0.22);
    color: #e2e8f0;
    border-radius: 10px;
  }

  .add-vendor-page input::placeholder { color: rgba(226,232,240,0.5); }

  .add-vendor-page .btn-secondary {
    background: rgba(2,6,23,0.55);
    color: #e2e8f0;
    border: 1px solid rgba(148,163,184,0.22);
  }

  .add-vendor-page .btn-secondary:hover {
    background: rgba(59,130,246,0.12);
    border-color: rgba(59,130,246,0.45);
  }

  .add-vendor-page .material-row { background: rgba(15,23,42,0.55); border: 1px solid rgba(148,163,184,0.18); border-radius: 12px; padding: 10px; }

  @media (max-width: 960px) {
    .add-vendor-page .material-row { grid-template-columns: 1fr 1fr; }
  }

  @media (max-width: 640px) {
    .add-vendor-page .material-row { grid-template-columns: 1fr; }
  }

  html:not(.dark) .add-vendor-toolbar {
    background: linear-gradient(135deg, rgba(248,250,252,0.98), rgba(241,245,249,0.96));
    border-color: #e2e8f0;
  }

  html:not(.dark) .add-vendor-card {
    background: #ffffff;
    border-color: #e2e8f0;
    box-shadow: 0 12px 26px rgba(15,23,42,0.08);
  }

  html:not(.dark) .add-vendor-page input,
  html:not(.dark) .add-vendor-page select,
  html:not(.dark) .add-vendor-page textarea {
    background: #ffffff;
    border-color: #cbd5e1;
    color: #0f172a;
  }

  html:not(.dark) .add-vendor-page input::placeholder { color: rgba(15,23,42,0.45); }

  html:not(.dark) .add-vendor-page .btn-secondary {
    background: #e2e8f0;
    border-color: #cbd5e1;
    color: #0f172a;
  }

  html:not(.dark) .add-vendor-page .material-row {
    background: #f8fafc;
    border-color: #e2e8f0;
  }
</style>

<div class="add-vendor-page">
<div class="add-vendor-toolbar" style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap;margin-bottom:16px">
  <div>
    <h1 class="page-title">Add Vendor</h1>
    <div class="help-text">Register a vendor and link supplied materials.</div>
  </div>
  <div style="display:flex;gap:10px;flex-wrap:wrap">
    {% if project_id %}
      <a href="/project/{{ project_id }}/materials" class="btn">← Back to Materials</a>
    {% else %}
      <a href="/dashboard" class="btn">← Dashboard</a>
    {% endif %}
  </div>
</div>

<div class="card card--page add-vendor-card">
  <form method="post" action="/vendors/add" id="addVendorForm">
    {% if project_id %}
      <input type="hidden" name="return_to" value="/project/{{ project_id }}/materials" />
    {% endif %}

    <div class="form-section">
      <div class="section-title">Basic Information</div>
      <div class="form-grid">
        <div>
          <label for="vendor_name">Vendor Name <span class="required">*</span></label>
          <input id="vendor_name" name="vendor_name" type="text" placeholder="e.g., ABC Suppliers" required />
        </div>
        <div>
          <label for="vendor_type">Vendor Type <span class="required">*</span></label>
          <select id="vendor_type" name="vendor_type" required>
            <option value="">Select type</option>
            <option value="Manufacturer">Manufacturer</option>
            <option value="Distributor">Distributor</option>
            <option value="Local Supplier">Local Supplier</option>
            <option value="Transporter">Transporter</option>
          </select>
        </div>
        <div>
          <label for="vendor_contact">Contact Number <span class="required">*</span></label>
          <input id="vendor_contact" name="vendor_contact" type="text" placeholder="+91 98765 43210" required />
        </div>
        <div>
          <label for="vendor_email">Email</label>
          <input id="vendor_email" name="vendor_email" type="email" placeholder="vendor@example.com" />
        </div>
        <div>
          <label for="vendor_location">Location <span class="required">*</span></label>
          <input id="vendor_location" name="vendor_location" type="text" placeholder="City, State" required />
        </div>
        <div>
          <label for="service_area">Service Area</label>
          <input id="service_area" name="service_area" type="text" placeholder="e.g., 50 km radius" />
        </div>
        <div>
          <label for="vendor_priority">Priority</label>
          <select id="vendor_priority" name="vendor_priority">
            <option value="Primary">Primary</option>
            <option value="Secondary">Secondary</option>
            <option value="Backup">Backup</option>
          </select>
        </div>
        <div>
          <label for="reliability_rating">Reliability</label>
          <select id="reliability_rating" name="reliability_rating">
            <option value="High">High</option>
            <option value="Medium" selected>Medium</option>
            <option value="Low">Low</option>
          </select>
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="section-title">Commercial Details</div>
      <div class="form-grid">
        <div>
          <label for="payment_terms">Payment Terms</label>
          <input id="payment_terms" name="payment_terms" type="text" placeholder="e.g., Net 30" />
        </div>
        <div>
          <label for="credit_period">Credit Period (days)</label>
          <input id="credit_period" name="credit_period" type="number" min="0" step="1" />
        </div>
        <div>
          <label for="gst_number">GST Number</label>
          <input id="gst_number" name="gst_number" type="text" />
        </div>
        <div>
          <label for="gst_percentage">GST %</label>
          <input id="gst_percentage" name="gst_percentage" type="number" min="0" step="0.1" value="18" />
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="section-title">Contract Details</div>
      <div class="form-grid">
        <div>
          <label for="contract_start_date">Contract Start</label>
          <input id="contract_start_date" name="contract_start_date" type="date" />
        </div>
        <div>
          <label for="contract_end_date">Contract End</label>
          <input id="contract_end_date" name="contract_end_date" type="date" />
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="section-title">Materials Supplied <span class="required">*</span></div>
      <div id="materialsContainer" style="display:grid;gap:12px;">
        <div class="material-row" style="display:grid;grid-template-columns:2fr 1fr 1fr 1fr 1fr auto;gap:10px;align-items:end;">
          <div>
            <label>Material</label>
            <select name="materials_supplied[]" required>
              <option value="">Select Material</option>
              {% for material in materials %}
                <option value="{{ material.id }}">{{ material.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label>Unit Price</label>
            <input name="unit_prices[]" type="number" min="0" step="0.01" />
          </div>
          <div>
            <label>Per Unit Qty</label>
            <input name="per_unit_quantities[]" type="number" min="0" step="0.01" />
          </div>
          <div>
            <label>Lead Time (days)</label>
            <input name="lead_times[]" type="number" min="0" step="1" value="0" />
          </div>
          <div>
            <label>Supply Capacity</label>
            <input name="supply_capacities[]" type="number" min="0" step="0.01" />
          </div>
          <button type="button" class="btn-secondary" onclick="removeMaterialRow(this)">Remove</button>
        </div>
      </div>
      <div style="margin-top:12px;">
        <button type="button" class="btn-secondary" onclick="addMaterialRow()">+ Add Material</button>
      </div>
    </div>

    <div style="display:flex;gap:12px;justify-content:flex-end;">
      {% if project_id %}
        <a href="/project/{{ project_id }}/materials" class="btn-secondary">Cancel</a>
      {% else %}
        <a href="/dashboard" class="btn-secondary">Cancel</a>
      {% endif %}
      <button class="btn-primary" type="submit">Add Vendor</button>
    </div>
  </form>
</div>

</div>

<script>
  function addMaterialRow() {
    const container = document.getElementById('materialsContainer');
    const firstRow = container.querySelector('.material-row');
    if (!firstRow) return;
    const clone = firstRow.cloneNode(true);
    clone.querySelectorAll('input, select').forEach((el) => {
      if (el.tagName.toLowerCase() === 'select') {
        el.selectedIndex = 0;
      } else {
        el.value = '';
      }
    });
    container.appendChild(clone);
  }

  function removeMaterialRow(button) {
    const rows = document.querySelectorAll('.material-row');
    if (rows.length <= 1) return;
    const row = button.closest('.material-row');
    if (row) row.remove();
  }
</script>

{% endblock %}
