{% extends "base.html" %}
{% block content %}
<style>
    /* Enhanced Form Styling with Hover & Glow Effects */
    .material-vendor-page {
        animation: fadeIn 0.4s ease-in;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Project Select Dropdown Enhancement */
    #project-select {
        background: var(--input-bg);
        border: 2px solid var(--input-border);
        border-radius: 8px;
        padding: 10px 16px;
        color: var(--text-primary);
        font-weight: 500;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    #project-select:hover {
        border-color: rgba(79, 140, 255, 0.6);
        box-shadow: 0 4px 16px rgba(79, 140, 255, 0.3), 0 0 20px rgba(79, 140, 255, 0.2);
        transform: translateY(-2px);
    }
    
    #project-select:focus {
        outline: none;
        border-color: #4f8cff;
        box-shadow: 0 0 0 4px rgba(79, 140, 255, 0.2), 0 0 30px rgba(79, 140, 255, 0.4);
    }
    
    /* Form Input Enhancements */
    input[type="text"],
    input[type="email"],
    input[type="number"],
    select,
    textarea {
        background: var(--input-bg);
        border: 2px solid var(--input-border);
        border-radius: 8px;
        padding: 10px 14px;
        color: var(--text-primary);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    input[type="text"]:hover,
    input[type="email"]:hover,
    input[type="number"]:hover,
    select:hover,
    textarea:hover {
        border-color: rgba(79, 140, 255, 0.4);
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2), 0 0 12px rgba(79, 140, 255, 0.15);
    }
    
    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="number"]:focus,
    select:focus,
    textarea:focus {
        outline: none;
        border-color: #4f8cff;
        box-shadow: 0 0 0 3px rgba(79, 140, 255, 0.2), 0 0 20px rgba(79, 140, 255, 0.3);
        transform: scale(1.01);
    }
    
    /* Label Enhancements */
    label {
        color: var(--text-secondary);
        font-weight: 600;
        font-size: 13px;
        letter-spacing: 0.3px;
        transition: color 0.2s ease;
    }
    
    label:hover {
        color: #4f8cff;
    }
    
    /* Button Enhancements with Glow */
    .btn-primary {
        background: linear-gradient(135deg, #4f8cff 0%, #3a6fd8 100%);
        border: none;
        border-radius: 10px;
        padding: 12px 32px;
        color: #fff;
        font-weight: 600;
        font-size: 15px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 15px rgba(79, 140, 255, 0.4), 0 0 30px rgba(79, 140, 255, 0.2);
        position: relative;
        overflow: hidden;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(79, 140, 255, 0.6), 0 0 40px rgba(79, 140, 255, 0.4);
    }
    
    .btn-primary:active {
        transform: translateY(0);
        box-shadow: 0 2px 10px rgba(79, 140, 255, 0.4);
    }
    
    .btn-primary::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
        pointer-events: none;
    }
    
    .btn-primary:hover::before {
        width: 300px;
        height: 300px;
    }
    
    /* Secondary Button */
    .btn-secondary {
        background: rgba(100, 116, 139, 0.2);
        border: 1px solid rgba(100, 116, 139, 0.4);
        border-radius: 10px;
        padding: 12px 32px;
        color: #cbd5e1;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
        background: rgba(100, 116, 139, 0.3);
        border-color: rgba(100, 116, 139, 0.6);
        transform: translateY(-2px);
    }
    
    /* Form Section Styling */
    .form-section {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .form-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(79, 140, 255, 0.3), transparent);
    }
    
    .form-section:hover {
        border-color: rgba(79, 140, 255, 0.3);
        box-shadow: 0 8px 32px rgba(79, 140, 255, 0.1);
    }
    
    /* Step Counter Styling */
    .step-counter {
        display: inline-block;
        background: linear-gradient(135deg, #4f8cff 0%, #3a6fd8 100%);
        color: #fff;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 8px rgba(79, 140, 255, 0.3);
        margin-left: auto;
    }
    
    /* Modal Enhancements */
    .modal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(4px);
        animation: modalFadeIn 0.3s ease;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    
    .modal.show {
        display: flex !important;
        opacity: 1 !important;
        pointer-events: auto !important;
        z-index: 2000 !important;
    }
    
    @keyframes modalFadeIn {
        from {
            opacity: 0;
            backdrop-filter: blur(0px);
        }
        to {
            opacity: 1;
            backdrop-filter: blur(4px);
        }
    }
    
    .modal-content {
        animation: modalSlideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        max-height: 90vh;
        overflow-y: auto;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 100px rgba(79, 140, 255, 0.2);
    }
    
    @keyframes modalSlideUp {
        from {
            opacity: 0;
            transform: translateY(40px) scale(0.95);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }
    
    /* Scrollbar Styling */
    .modal-content::-webkit-scrollbar {
        width: 8px;
    }
    
    .modal-content::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
        border-radius: 10px;
    }
    
    .dark .modal-content::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
    }
    
    .modal-content::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #4f8cff 0%, #3a6fd8 100%);
        border-radius: 10px;
        transition: all 0.3s ease;
    }
    
    .modal-content::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #5fa5ff 0%, #4a7fea 100%);
    }
    
    /* Close Button */
    .close {
        position: absolute;
        right: 18px;
        top: 12px;
        font-size: 24px;
        color: #ef4444;
        cursor: pointer;
        transition: all 0.2s ease;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(239, 68, 68, 0.1);
        border-radius: 8px;
        border: 1px solid rgba(239, 68, 68, 0.3);
    }
    
    .close:hover {
        background: rgba(239, 68, 68, 0.2);
        border-color: rgba(239, 68, 68, 0.5);
        transform: rotate(90deg) scale(1.1);
    }
    
    /* Info Box Styling */
    .info-box {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(79, 140, 255, 0.05) 100%);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-left: 4px solid #3b82f6;
        border-radius: 8px;
        padding: 14px 16px;
        margin-bottom: 20px;
        display: flex;
        gap: 12px;
        align-items: flex-start;
    }
    
    .info-box-icon {
        font-size: 20px;
        flex-shrink: 0;
        margin-top: 2px;
    }
    
    .info-box-text {
        color: #cbd5e1;
        font-size: 13px;
        line-height: 1.6;
    }
    
    .info-box-text strong {
        color: #3b82f6;
        font-weight: 700;
    }
    
    /* Loading State */
    button:disabled {
        opacity: 0.7;
        cursor: not-allowed;
    }
    
    .btn-primary:disabled {
        animation: none;
    }
    
    /* Form Success State */
    input:valid {
        border-color: rgba(34, 197, 94, 0.4);
    }
    
    input:invalid:not(:placeholder-shown) {
        border-color: rgba(239, 68, 68, 0.4);
    }
    
    /* Placeholder Styling */
    input::placeholder,
    select::placeholder,
    textarea::placeholder {
        color: rgba(255, 255, 255, 0.4);
    }
    
    /* Select Option Styling */
    select option {
        background: #1e293b;
        color: #fff;
        padding: 8px;
    }
    
    select option:checked {
        background: linear-gradient(#4f8cff, #4f8cff);
        color: #fff;
    }
    
    /* Badge Styling */
    .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        background: linear-gradient(135deg, rgba(79, 140, 255, 0.2) 0%, rgba(59, 130, 246, 0.1) 100%);
        border: 1px solid rgba(79, 140, 255, 0.3);
        color: #3b82f6;
    }
    
    /* Tooltip Styling */
    [title] {
        position: relative;
    }
    
    /* Card Hover Enhancement */
    .vendor-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .vendor-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 32px rgba(79, 140, 255, 0.2);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .modal-content {
            max-width: 95vw !important;
            margin: 20px;
        }
        
        .form-grid {
            grid-template-columns: 1fr !important;
        }
        
        .btn-primary,
        .btn-secondary {
            width: 100%;
            justify-content: center;
        }
    }
    
    .btn-primary::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }
    
    .btn-primary:hover::before {
        width: 300px;
        height: 300px;
    }
    
    .btn-primary:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 8px 25px rgba(79, 140, 255, 0.6), 0 0 50px rgba(79, 140, 255, 0.4);
    }
    
    .btn-primary:active {
        transform: translateY(-1px) scale(1.02);
    }
    
    /* Secondary Button Styles */
    .btn-info {
        background: linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%);
        border: none;
        border-radius: 8px;
        padding: 8px 16px;
        color: #fff;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(56, 189, 248, 0.3);
    }
    
    .btn-info:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(56, 189, 248, 0.5), 0 0 20px rgba(56, 189, 248, 0.3);
    }
    
    .btn-add-vendor {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        border: none;
        border-radius: 8px;
        padding: 6px 12px;
        color: #fff;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 13px;
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }
    
    .btn-add-vendor:hover {
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 4px 16px rgba(16, 185, 129, 0.5), 0 0 20px rgba(16, 185, 129, 0.3);
    }
    
    /* Card Enhancements */
    .card--page {
        background: var(--card-bg) !important;
        border: 1px solid var(--border-color) !important;
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), 0 0 80px rgba(79, 140, 255, 0.05) !important;
        transition: all 0.3s ease;
    }
    
    .card--page:hover {
        border-color: rgba(79, 140, 255, 0.2) !important;
        box-shadow: 0 12px 48px rgba(0, 0, 0, 0.5), 0 0 100px rgba(79, 140, 255, 0.1) !important;
    }
    
    /* Override global card class for material-vendor page */
    .card.card--page {
        background: var(--card-bg) !important;
    }
    
    /* Form Section Dividers */
    h3 {
        color: #4f8cff;
        font-weight: 700;
        font-size: 20px;
        margin-bottom: 16px;
        position: relative;
        padding-bottom: 8px;
    }
    
    h3::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, #4f8cff 0%, transparent 100%);
        border-radius: 2px;
        box-shadow: 0 0 10px rgba(79, 140, 255, 0.5);
    }
    
    /* Table Enhancements */
    .table {
        background: var(--card-bg);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }
    
    .table thead th {
        background: rgba(0,0,0,0.03);
        color: #4f8cff;
        font-weight: 600;
        padding: 14px 16px;
        text-transform: uppercase;
        font-size: 12px;
        letter-spacing: 0.5px;
        border-bottom: 2px solid var(--border-color);
    }
    
    .dark .table thead th {
        background: rgba(255,255,255,0.03);
    }
    
    .table tbody tr {
        transition: all 0.3s ease;
        border-bottom: 1px solid var(--border-color);
    }
    
    .table tbody tr:hover {
        background: rgba(79, 140, 255, 0.1);
        transform: scale(1.01);
        box-shadow: 0 4px 12px rgba(79, 140, 255, 0.2);
    }
    
    .table tbody td {
        padding: 14px 16px;
        color: var(--text-primary);
    }
    
    /* Badge Enhancements */
    .badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        display: inline-block;
        transition: all 0.3s ease;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    
    .badge:hover {
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .badge-info {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: #fff;
    }
    
    .badge-info:hover {
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.5), 0 0 20px rgba(59, 130, 246, 0.3);
    }
    
    .badge-danger {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: #fff;
    }
    
    .badge-danger:hover {
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.5), 0 0 20px rgba(239, 68, 68, 0.3);
    }
    
    .badge-secondary {
        background: linear-gradient(135deg, #64748b 0%, #475569 100%);
        color: #fff;
    }
    
    .badge-secondary:hover {
        box-shadow: 0 4px 12px rgba(100, 116, 139, 0.5);
    }
    
    /* Help Icon Enhancements */
    span[title] {
        cursor: help;
        transition: all 0.3s ease;
        display: inline-block;
    }
    
    span[title]:hover {
        color: #4f8cff;
        transform: scale(1.2);
        filter: drop-shadow(0 0 8px rgba(79, 140, 255, 0.8));
    }
    
    /* Form Grid Animation */
    .form-grid > div {
        animation: slideIn 0.5s ease forwards;
        opacity: 0;
    }
    
    .form-grid > div:nth-child(1) { animation-delay: 0.1s; }
    .form-grid > div:nth-child(2) { animation-delay: 0.2s; }
    .form-grid > div:nth-child(3) { animation-delay: 0.3s; }
    .form-grid > div:nth-child(4) { animation-delay: 0.4s; }
    
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    /* Page Title Enhancement */
    .page-title {
        background: linear-gradient(135deg, #4f8cff 0%, #3a6fd8 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 28px;
        font-weight: 800;
        margin-bottom: 24px;
        text-shadow: 0 0 40px rgba(79, 140, 255, 0.3);
        animation: titlePulse 3s ease-in-out infinite;
    }
    
    @keyframes titlePulse {
        0%, 100% { filter: brightness(1); }
        50% { filter: brightness(1.2); }
    }
    
    @keyframes slideInRight {
        from {
            transform: translateX(400px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOutRight {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(400px);
            opacity: 0;
        }
    }
    
    /* Smooth Scroll */
    html {
        scroll-behavior: smooth;
    }

    /* Add Material Modal Light/Dark Overrides */
    #addMaterialModal .modal-content {
        background: var(--bg) !important;
        border-color: var(--border-color) !important;
        color: var(--text-primary);
    }
    #addMaterialModal .modal-content > div:first-child {
        background: var(--card-bg) !important;
        border-bottom: 1px solid var(--border-color) !important;
    }
    #addMaterialModal h2,
    #addMaterialModal h4 {
        color: var(--text-primary) !important;
    }
    #addMaterialModal p,
    #addMaterialModal small {
        color: var(--text-secondary) !important;
    }
    #addMaterialModal label {
        color: var(--text-secondary) !important;
    }
    #addMaterialModal input,
    #addMaterialModal select,
    #addMaterialModal textarea {
        background: var(--input-bg) !important;
        color: var(--text-primary) !important;
        border-color: var(--input-border) !important;
    }
    #addMaterialModal input::placeholder,
    #addMaterialModal textarea::placeholder {
        color: var(--text-muted) !important;
    }
    #addMaterialModal .modal-content div[style*="border-left: 6px"] {
        background: var(--card-bg) !important;
        border-color: var(--border-color) !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
    }
    #addMaterialModal .modal-content div[style*="border-bottom: 2px solid"] {
        border-bottom: 1px solid var(--border-color) !important;
    }
    #addMaterialModal #activityDropdownList,
    #addMaterialModal #stretchDropdownList {
        background: var(--card-bg) !important;
        border-color: var(--border-color) !important;
    }
    #addMaterialModal #activityDropdownList label,
    #addMaterialModal #stretchDropdownList label {
        color: var(--text-primary) !important;
    }
    #addMaterialModal #activityDropdownList label:hover,
    #addMaterialModal #stretchDropdownList label:hover {
        background: rgba(0, 0, 0, 0.04) !important;
    }
    .dark #addMaterialModal #activityDropdownList label:hover,
    .dark #addMaterialModal #stretchDropdownList label:hover {
        background: rgba(255, 255, 255, 0.04) !important;
    }

    /* Add Vendor Modal Light/Dark Overrides */
    #addVendorModal .modal-content {
        background: var(--bg) !important;
        color: var(--text-primary) !important;
    }
    #addVendorModal .modal-content > div:first-child {
        background: var(--card-bg) !important;
        border-bottom: 1px solid var(--border-color) !important;
    }
    #addVendorModal h3,
    #addVendorModal h4 {
        color: var(--text-primary) !important;
    }
    #addVendorModal p,
    #addVendorModal small,
    #addVendorModal label {
        color: var(--text-secondary) !important;
    }
    #addVendorModal input,
    #addVendorModal select,
    #addVendorModal textarea {
        background: var(--input-bg) !important;
        color: var(--text-primary) !important;
        border-color: var(--input-border) !important;
    }
    #addVendorModal input::placeholder,
    #addVendorModal textarea::placeholder {
        color: var(--text-muted) !important;
    }
    #addVendorModal .material-row {
        background: var(--card-bg) !important;
        border-color: var(--border-color) !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
    }
    #addVendorModal .material-row label {
        color: var(--text-secondary) !important;
    }
    #addVendorModal .material-row select,
    #addVendorModal .material-row input {
        background: var(--input-bg) !important;
        color: var(--text-primary) !important;
        border-color: var(--input-border) !important;
    }
    #addVendorModal div[style*="border-left: 6px"] {
        background: var(--card-bg) !important;
        border-color: var(--border-color) !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06) !important;
    }
    #addVendorModal div[style*="background: linear-gradient(135deg, rgba(79, 140, 255"] {
        background: rgba(79, 140, 255, 0.06) !important;
        border-color: var(--border-color) !important;
    }
    #addVendorModal span[style*="color: #94a3b8"] {
        color: var(--text-secondary) !important;
    }

    /* Collapsible sections for long pages */
    .collapsible-section {
        margin-bottom: 32px;
        border: 1px solid var(--border-color);
        border-radius: 14px;
        background: var(--card-bg);
        overflow: hidden;
    }
    .collapsible-section summary {
        list-style: none;
        cursor: pointer;
        padding: 16px 18px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        font-weight: 700;
        color: var(--text-primary);
        background: linear-gradient(135deg, rgba(79, 140, 255, 0.08) 0%, rgba(79, 140, 255, 0.03) 100%);
    }
    .collapsible-section summary::-webkit-details-marker {
        display: none;
    }
    .collapsible-section .section-body {
        padding: 18px;
        border-top: 1px solid var(--border-color);
    }
    .collapsible-section .chevron {
        transition: transform 0.2s ease;
        color: #4f8cff;
        font-size: 14px;
    }
    .collapsible-section[open] .chevron {
        transform: rotate(180deg);
    }
</style>

<div class="material-vendor-page">
<!-- Project Selection Dropdown -->
<form method="get" action="" id="project-select-form" style="margin-bottom:24px;">
    <label for="project-select"><strong>Select Project:</strong></label>
    <select id="project-select" name="project_id" onchange="if(this.value) window.location.href='/project/' + this.value + '/materials';">
        <option value="">-- Choose Project --</option>
        {% for proj in projects %}
            <option value="{{ proj.id }}" {% if project and proj.id == project.id %}selected{% endif %}>{{ proj.name }}</option>
        {% endfor %}
    </select>
</form>

<h1 class="page-title">Material & Vendor Management ‚Äì {{ project.name }}</h1>
<div class="card card--page" style="max-width:1100px;margin:auto;">
    <!-- Project Context -->
    <div style="margin-bottom:24px;padding:16px;background:var(--card-bg);border:1px solid var(--border-color);border-radius:12px;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;">
        <div style="display:flex;align-items:center;gap:12px;">
            <span style="font-size:20px;color:#4f8cff;">üìç</span>
            <div>
                <div style="color:var(--text-secondary);font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;">Location</div>
                <div style="color:var(--text-primary);font-weight:600;margin-top:4px;">{{ project.location }}</div>
            </div>
        </div>
        <div style="display:flex;align-items:center;gap:12px;">
            <span style="font-size:20px;color:#f59e0b;">üìÖ</span>
            <div>
                <div style="color:var(--text-secondary);font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;">Timeline</div>
                <div style="color:var(--text-primary);font-weight:600;margin-top:4px;">{{ project.planned_start_date }} ‚Äì {{ project.planned_end_date }}</div>
            </div>
        </div>
        <div style="display:flex;align-items:center;gap:12px;">
            <span style="font-size:20px;color:#10b981;">‚úì</span>
            <div>
                <div style="color:var(--text-secondary);font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;">Status</div>
                <div style="color:#10b981;font-weight:600;margin-top:4px;text-transform:capitalize;">{{ project.status }}</div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div style="margin-bottom: 40px; display: flex; gap: 16px; flex-wrap: wrap; align-items: center;">
        <a href="/project/{{ project.id }}/materials/add" id="addMaterialBtn" class="btn-primary" style="padding: 14px 28px; font-size: 16px; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 15px rgba(79, 140, 255, 0.4), 0 0 30px rgba(79, 140, 255, 0.2);" title="Add a new material to the system">
            <span style="font-size: 18px;">üì¶</span>
            <span>Add Material</span>
        </a>
        <a href="/vendors/add?project_id={{ project.id }}" id="addVendorBtn" class="btn-primary" style="padding: 14px 28px; font-size: 16px; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 15px rgba(79, 140, 255, 0.4), 0 0 30px rgba(79, 140, 255, 0.2);" title="Add a new vendor to the system">
            <span style="font-size: 18px;">üè¢</span>
            <span>Add Vendor</span>
        </a>
        <div style="flex: 1; height: 1px; background: linear-gradient(90deg, transparent, rgba(79, 140, 255, 0.2), transparent); margin-left: 16px;"></div>
    </div>

    <!-- All Vendors Section - Card Based UI -->
    <details class="collapsible-section">
        <summary>
            <span>All Vendors</span>
            <span class="chevron">‚ñº</span>
        </summary>
        <div class="section-body">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px;color:var(--text-secondary);font-size:12px;">
                <span title="View and manage all vendors in the system with an easy-to-use card interface" style="cursor:help;color:#4f8cff;">&#9432;</span>
                <span>Manage vendor cards and status</span>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 20px; margin-bottom: 12px;">
            {% for vendor in all_vendors %}
                <div data-vendor-id="{{ vendor.id }}" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 1px solid rgba(79, 140, 255, 0.2); border-radius: 16px; padding: 20px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3); transition: all 0.3s ease;" onmouseenter="this.style.boxShadow='0 8px 32px rgba(79, 140, 255, 0.3)'; this.style.borderColor='rgba(79, 140, 255, 0.4)'" onmouseleave="this.style.boxShadow='0 4px 16px rgba(0, 0, 0, 0.3)'; this.style.borderColor='rgba(79, 140, 255, 0.2)'">
                    
                    <!-- Header with Vendor Name and Status -->
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px; border-bottom: 2px solid rgba(79, 140, 255, 0.3); padding-bottom: 12px;">
                        <div>
                            <h4 style="margin: 0 0 4px 0; color: #4f8cff; font-size: 16px; font-weight: 700;">
                                üè¢ {{ vendor.vendor_name }}
                            </h4>
                        </div>
                        <span style="background: {% if vendor.is_active %}linear-gradient(135deg, #10b981 0%, #059669 100%){% else %}linear-gradient(135deg, #ef4444 0%, #dc2626 100%){% endif %}; color: #fff; padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: 600; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);">
                            {% if vendor.is_active %}‚úì Active{% else %}‚úï Inactive{% endif %}
                        </span>
                    </div>
                    
                    <!-- Material Badge -->
                    <div style="margin-bottom: 16px;">
                        <span style="font-size: 12px; color: #94a3b8; font-weight: 600;">üì¶ Material</span>
                        <div style="margin-top: 6px;">
                            <span style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: #fff; padding: 8px 12px; border-radius: 8px; font-size: 13px; font-weight: 500; box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);">
                                {{ vendor.material.name if vendor.material else 'Unlinked' }}
                            </span>
                        </div>
                    </div>
                    
                    <!-- Contact Information Grid -->
                    <div style="display: grid; gap: 12px; margin-bottom: 16px;">
                        <!-- Contact Person -->
                        <div>
                            <span style="font-size: 12px; color: #94a3b8; font-weight: 600;">üë§ Contact Person</span>
                            <p style="margin: 6px 0 0 0; color: #cbd5e1; font-size: 13px;">
                                {{ vendor.contact_person or vendor.phone or '‚Äî' }}
                            </p>
                        </div>
                        
                        <!-- Email -->
                        <div>
                            <span style="font-size: 12px; color: #94a3b8; font-weight: 600;">üìß Email</span>
                            <p style="margin: 6px 0 0 0; color: #cbd5e1; font-size: 13px; word-break: break-all;">
                                {{ vendor.email or '‚Äî' }}
                            </p>
                        </div>
                    </div>
                    
                    <!-- Specifications -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; padding: 12px; background: rgba(79, 140, 255, 0.05); border-radius: 8px;">
                        <div>
                            <span style="font-size: 11px; color: #94a3b8; font-weight: 600; text-transform: uppercase;">‚è±Ô∏è Lead Time</span>
                            <p style="margin: 6px 0 0 0; color: #4f8cff; font-size: 16px; font-weight: 700;">
                                {{ vendor.lead_time_days if vendor.lead_time_days is not none else '0' }} <span style="font-size: 11px; color: #94a3b8;">days</span>
                            </p>
                        </div>
                        <div>
                            <span style="font-size: 11px; color: #94a3b8; font-weight: 600; text-transform: uppercase;">üì¶ Min Order</span>
                            <p style="margin: 6px 0 0 0; color: #4f8cff; font-size: 16px; font-weight: 700;">
                                {{ vendor.min_order_qty if vendor.min_order_qty is not none else '‚Äî' }}
                            </p>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 10px; border-top: 1px solid rgba(79, 140, 255, 0.2); padding-top: 12px;">
                        <button class="btn-info btn-sm" onclick="editVendor({{ vendor.id }}, '{{ vendor.vendor_name }}', '{{ vendor.contact_person or '' }}', '{{ vendor.email or '' }}', {{ vendor.material_id or 0 }}, {{ vendor.lead_time_days or 0 }}, {{ vendor.min_order_qty or 0 }}, {{ 'true' if vendor.is_active else 'false' }})" title="Edit vendor details" style="flex: 1; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: none; border-radius: 8px; padding: 10px 12px; color: #fff; font-weight: 600; cursor: pointer; font-size: 13px; transition: all 0.3s ease;"
                            onmouseenter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.4)'"
                            onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            ‚úèÔ∏è Edit
                        </button>
                        <button class="btn-toggle-status" onclick="toggleVendorStatus({{ vendor.id }}, {{ 'true' if vendor.is_active else 'false' }})" title="Toggle active status" style="flex: 1; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border: none; border-radius: 8px; padding: 10px 12px; color: #fff; font-weight: 600; cursor: pointer; font-size: 13px; transition: all 0.3s ease;"
                            onmouseenter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(245, 158, 11, 0.4)'"
                            onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            {{ 'üîí Deactivate' if vendor.is_active else '‚úÖ Activate' }}
                        </button>
                        <button onclick="deleteVendor({{ vendor.id }})" title="Remove vendor" style="flex: 1; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border: none; border-radius: 8px; padding: 10px 12px; color: #fff; font-weight: 600; cursor: pointer; font-size: 13px; transition: all 0.3s ease;"
                            onmouseenter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.4)'"
                            onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            üóëÔ∏è Remove
                        </button>
                    </div>
                </div>
            {% endfor %}
            </div>
        </div>
    </details>

    <!-- Edit Vendor Modal -->
    <div id="editVendorModal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="closeEditVendorModal()">&times;</span>
            <h3 style="margin-top: 0;">Edit Vendor Details</h3>
            <form id="editVendorForm" method="post" onsubmit="return submitEditVendor(event)">
                <input type="hidden" id="edit_vendor_id" name="vendor_id">
                <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div>
                        <label for="edit_vendor_name" style="display:block;margin-bottom:4px;font-weight:600;">Vendor Name</label>
                        <input type="text" id="edit_vendor_name" name="vendor_name" required>
                    </div>
                    <div>
                        <label for="edit_vendor_contact" style="display:block;margin-bottom:4px;font-weight:600;">Contact Person</label>
                        <input type="text" id="edit_vendor_contact" name="contact_person">
                    </div>
                    <div>
                        <label for="edit_vendor_email" style="display:block;margin-bottom:4px;font-weight:600;">Email</label>
                        <input type="email" id="edit_vendor_email" name="email">
                    </div>
                    <div>
                        <label for="edit_materials_supplied" style="display:block;margin-bottom:4px;font-weight:600;">Material</label>
                        <select id="edit_materials_supplied" name="material_id" required>
                            {% for material in materials %}
                            <option value="{{ material.id }}">{{ material.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="edit_lead_time" style="display:block;margin-bottom:4px;font-weight:600;">Lead Time (days)</label>
                        <input type="number" id="edit_lead_time" name="lead_time_days" min="0">
                    </div>
                    <div>
                        <label for="edit_min_order_qty" style="display:block;margin-bottom:4px;font-weight:600;">Min Order Qty</label>
                        <input type="number" id="edit_min_order_qty" name="min_order_qty" step="0.01" min="0">
                    </div>
                </div>
                <div style="margin-top:24px;display:flex;gap:12px;justify-content:flex-end;">
                    <button type="button" onclick="closeEditVendorModal()" style="background: #64748b; border: none; border-radius: 8px; padding: 10px 20px; color: #fff; font-weight: 500; cursor: pointer;">Cancel</button>
                    <button type="submit" class="btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <style>
        .btn-toggle-status:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(245, 158, 11, 0.5), 0 0 20px rgba(245, 158, 11, 0.3);
        }
    </style>

    <script>
        // Show success/error messages from URL params
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const success = urlParams.get('success');
            const error = urlParams.get('error');
            
            if (success) {
                showNotification(success, 'success');
                // Scroll to vendors section
                setTimeout(() => {
                    const vendorsSection = document.querySelector('#vendorsTableBody');
                    if (vendorsSection) {
                        vendorsSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 100);
            }
            if (error) {
                showNotification(error, 'error');
            }
        });
        
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                background: ${type === 'success' ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)'};
                color: white;
                border-radius: 12px;
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3), 0 0 40px ${type === 'success' ? 'rgba(16, 185, 129, 0.3)' : 'rgba(239, 68, 68, 0.3)'};
                z-index: 10000;
                font-weight: 600;
                animation: slideInRight 0.3s ease;
            `;
            notification.textContent = message.replace(/\+/g, ' ');
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        function editVendor(id, name, contact, email, materialId, leadTime, minOrderQty, isActive) {
            document.getElementById('edit_vendor_id').value = id;
            document.getElementById('edit_vendor_name').value = name;
            document.getElementById('edit_vendor_contact').value = contact || '';
            document.getElementById('edit_vendor_email').value = email || '';
            document.getElementById('edit_materials_supplied').value = materialId;
            document.getElementById('edit_lead_time').value = leadTime || 0;
            document.getElementById('edit_min_order_qty').value = minOrderQty || 0;
            document.getElementById('editVendorModal').style.display = 'flex';
        }

        function closeEditVendorModal() {
            document.getElementById('editVendorModal').style.display = 'none';
        }

        function submitEditVendor(event) {
            event.preventDefault();
            const form = document.getElementById('editVendorForm');
            const formData = new FormData(form);
            const vendorId = document.getElementById('edit_vendor_id').value;
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            
            console.log('Submitting edit for vendor:', vendorId);
            console.log('Form data:', Object.fromEntries(formData));
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Updating...';
            
            fetch(`/vendors/${vendorId}/update`, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Response data:', data);
                if (data.success) {
                    closeEditVendorModal();
                    showNotification('Vendor updated successfully', 'success');
                    // Reload after a short delay
                    setTimeout(() => window.location.reload(), 500);
                } else {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    showNotification(data.error || 'Failed to update vendor', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                showNotification('An error occurred: ' + error.message, 'error');
            });
            
            return false;
        }

        function toggleVendorStatus(vendorId, currentStatus) {
            const action = currentStatus ? 'deactivate' : 'activate';
            const button = event.target;
            const originalText = button.textContent;
            
            if (confirm(`Are you sure you want to ${action} this vendor?`)) {
                button.disabled = true;
                button.textContent = 'Updating...';
                
                fetch(`/vendors/${vendorId}/toggle`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification(`Vendor ${action}d successfully`, 'success');
                        
                        // Update card UI - find the vendor card and update status badge
                        const vendorCard = document.querySelector(`[data-vendor-id="${vendorId}"]`);
                        if (vendorCard) {
                            // Update status badge in the header
                            const statusBadge = vendorCard.querySelector('span[style*="linear-gradient"]');
                            if (statusBadge) {
                                if (data.is_active) {
                                    statusBadge.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                                    statusBadge.textContent = '‚úì Active';
                                } else {
                                    statusBadge.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                                    statusBadge.textContent = '‚úï Inactive';
                                }
                            }
                        }
                        
                        // Update button text and onclick
                        button.textContent = data.is_active ? 'üîí Deactivate' : '‚úÖ Activate';
                        button.onclick = () => toggleVendorStatus(vendorId, data.is_active);
                        button.disabled = false;
                    } else {
                        button.textContent = originalText;
                        button.disabled = false;
                        showNotification('Failed to update vendor status', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    button.textContent = originalText;
                    button.disabled = false;
                    showNotification('An error occurred. Please try again.', 'error');
                });
            }
        }

        function deleteVendor(vendorId) {
            if (!confirm('Remove this vendor? This cannot be undone.')) {
                return;
            }

            fetch(`/vendors/${vendorId}/delete`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Vendor removed successfully', 'success');
                    const vendorCard = document.querySelector(`[data-vendor-id="${vendorId}"]`);
                    if (vendorCard) {
                        vendorCard.remove();
                    }
                } else {
                    showNotification(data.error || 'Failed to remove vendor', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('An error occurred. Please try again.', 'error');
            });
        }

        // Add Material Modal Functions
        function openAddMaterialModal() {
            const modal = document.getElementById('addMaterialModal');
            if (modal) {
                modal.classList.add('show');
                console.log('Add Material Modal opened');
            }
        }

        function closeAddMaterialModal() {
            const modal = document.getElementById('addMaterialModal');
            const form = document.getElementById('addMaterialForm');
            if (modal) {
                modal.classList.remove('show');
            }
            if (form) {
                form.reset();
            }
            console.log('Add Material Modal closed');
        }

        // Toggle custom category input
        function toggleCustomCategoryInput() {
            var categorySelect = document.getElementById('modal_material-category-select');
            var customInput = document.getElementById('modal_custom-material-category');
            
            if (!categorySelect || !customInput) return;
            
            if (categorySelect.value === 'Custom') {
                customInput.required = true;
                customInput.placeholder = 'Enter custom category (required)';
            } else {
                customInput.required = false;
                customInput.placeholder = 'Type here for custom category (optional)';
            }
        }

        // Add Vendor Modal Functions
        function openAddVendorModal() {
            const modal = document.getElementById('addVendorModal');
            console.log('openAddVendorModal called');
            console.log('Modal element:', modal);
            if (modal) {
                console.log('Before add: display =', window.getComputedStyle(modal).display);
                modal.classList.add('show');
                console.log('After add: display =', window.getComputedStyle(modal).display);
                console.log('classList:', modal.className);
            } else {
                console.error('Add Vendor Modal element not found!');
            }
        }

        function closeAddVendorModal() {
            const modal = document.getElementById('addVendorModal');
            const form = document.getElementById('addVendorForm');
            if (modal) {
                modal.classList.remove('show');
            }
            if (form) {
                form.reset();
            }
            console.log('Add Vendor Modal closed');
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            var addMaterialModal = document.getElementById('addMaterialModal');
            var addVendorModal = document.getElementById('addVendorModal');
            
            // Only close if clicking directly on the modal background, not the content
            if (addMaterialModal && event.target == addMaterialModal) {
                addMaterialModal.classList.remove('show');
            }
            if (addVendorModal && event.target == addVendorModal) {
                addVendorModal.classList.remove('show');
            }
        }

        // Format date input to DD/MM/YYYY
        function formatDateInput(input) {
            let value = input.value.replace(/[^0-9]/g, '');
            if (value.length > 2 && value.length <= 4) {
                value = value.slice(0,2) + '/' + value.slice(2);
            } else if (value.length > 4) {
                value = value.slice(0,2) + '/' + value.slice(2,4) + '/' + value.slice(4,8);
            }
            input.value = value.slice(0, 10);
        }

        // Toggle credit period field
        function toggleCreditPeriod() {
            const paymentTerms = document.getElementById('payment_terms');
            const creditDiv = document.getElementById('creditPeriodDiv');
            if (paymentTerms && creditDiv) {
                if (paymentTerms.value === 'Credit') {
                    creditDiv.style.display = 'block';
                } else {
                    creditDiv.style.display = 'none';
                }
            }
        }

        // Toggle contract section
        function toggleContractSection() {
            const section = document.getElementById('contractSection');
            const icon = document.getElementById('contractToggleIcon');
            if (section.style.display === 'none') {
                section.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
            } else {
                section.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // Add material row
        function addMaterialRow() {
            const container = document.getElementById('materialsSuppliedContainer');
            const newRow = container.querySelector('.material-row').cloneNode(true);
            
            // Clear input values
            newRow.querySelectorAll('input').forEach(input => input.value = '');
            newRow.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
            
            container.appendChild(newRow);
        }

        // Remove material row
        function removeMaterialRow(button) {
            const container = document.getElementById('materialsSuppliedContainer');
            if (container.querySelectorAll('.material-row').length > 1) {
                button.closest('.material-row').remove();
            } else {
                alert('At least one material row is required');
            }
        }

        // Initialize modals on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Modals are hidden by default via CSS - no need to set inline styles
        });
    </script>

    <!-- Material‚ÄìVendor Linking Table -->
    <details class="collapsible-section">
        <summary>
            <span>Material‚ÄìVendor Linking</span>
            <span class="chevron">‚ñº</span>
        </summary>
        <div class="section-body">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px;color:var(--text-secondary);font-size:12px;">
                <span title="Link vendors to each material. Click Edit to manage vendors for a material." style="cursor:help;color:#4f8cff;">&#9432;</span>
                <span>Link vendors per material</span>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 20px; margin-bottom: 12px;">
        {% for material in materials %}
        <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 20px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); transition: all 0.3s ease;" onmouseenter="this.style.boxShadow='0 8px 32px rgba(79, 140, 255, 0.2)'; this.style.borderColor='rgba(79, 140, 255, 0.4)'" onmouseleave="this.style.boxShadow='0 4px 16px rgba(0, 0, 0, 0.1)'; this.style.borderColor='var(--border-color)'">
            
            <!-- Material Header -->
            <div style="margin-bottom: 16px; border-bottom: 2px solid rgba(79, 140, 255, 0.3); padding-bottom: 12px;">
                <h4 style="margin: 0; color: #4f8cff; font-size: 16px; font-weight: 700;">
                    üì¶ {{ material.name }}
                </h4>
            </div>
            
            <!-- Vendors Section -->
            <div style="margin-bottom: 16px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                    <span style="color: #3b82f6; font-size: 14px; font-weight: 600;">üè¢ Linked Vendors</span>
                    <span style="font-size: 12px; color: var(--text-secondary); background: rgba(59, 130, 246, 0.1); padding: 2px 8px; border-radius: 12px;">
                        {% if material.vendors %}{{ material.vendors|length }}{% else %}0{% endif %}
                    </span>
                </div>
                <div style="min-height: 40px; display: flex; flex-wrap: wrap; gap: 6px; align-items: center;">
                    {% if material.vendors %}
                        {% for vendor in material.vendors %}
                            <span style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: #fff; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 500; box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);" title="Vendor: {{ vendor.vendor_name }}&#10;Lead Time: {{ vendor.lead_time_days }}d">
                                {{ vendor.vendor_name }}
                            </span>
                        {% endfor %}
                    {% else %}
                        <span style="color: #ef4444; font-size: 12px; font-weight: 600; background: rgba(239, 68, 68, 0.1); padding: 4px 8px; border-radius: 6px;">
                            ‚ö†Ô∏è No vendors linked
                        </span>
                    {% endif %}
                </div>
            </div>
            
            <!-- Contact Information Grid -->
            {% if material.vendors %}
            <div style="background: rgba(59, 130, 246, 0.05); border: 1px solid rgba(59, 130, 246, 0.1); border-radius: 10px; padding: 12px; margin-bottom: 16px;">
                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">
                    üìã Contact Information
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    {% for vendor in material.vendors %}
                        <div style="font-size: 11px;">
                            <div style="color: var(--text-secondary); margin-bottom: 2px;">{{ vendor.vendor_name }}</div>
                            <div style="color: var(--text-secondary);opacity:0.8;">üë§ {{ vendor.contact_person or '-' }}</div>
                            <div style="color: var(--text-secondary);opacity:0.8;">üìß {{ vendor.email or '-' }}</div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- Lead Time Specs -->
            {% if material.vendors %}
            <div style="background: rgba(168, 85, 247, 0.05); border: 1px solid rgba(168, 85, 247, 0.1); border-radius: 10px; padding: 12px; margin-bottom: 16px;">
                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">
                    ‚è±Ô∏è Supply Details
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    {% for vendor in material.vendors %}
                        <div style="font-size: 11px; color: var(--text-primary);">
                            <span style="font-weight: 600;">{{ vendor.vendor_name }}</span><br>
                            Lead: <span style="color: #a855f7;">{{ vendor.lead_time_days }}d</span> | Min: <span style="color: #a855f7;">{{ vendor.min_order_qty }}</span>
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- Action Button -->
            <button onclick="openVendorModal('{{ material.id }}', '{{ material.name }}')" style="width: 100%; background: linear-gradient(135deg, #4f8cff 0%, #3a6fd8 100%); color: #fff; border: none; border-radius: 10px; padding: 12px 16px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(79, 140, 255, 0.3);" onmouseover="this.style.boxShadow='0 6px 20px rgba(79, 140, 255, 0.5)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='0 4px 12px rgba(79, 140, 255, 0.3)'; this.style.transform='translateY(0)'">
                ‚úèÔ∏è Manage Vendors
            </button>
        </div>
        {% endfor %}
            </div>
        </div>
    </details>

    <!-- Stretch & Activity Linking Section -->
    <details class="collapsible-section">
        <summary>
            <span>Material‚ÄìStretch & Activity Linking</span>
            <span class="chevron">‚ñº</span>
        </summary>
        <div class="section-body">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px;color:var(--text-secondary);font-size:12px;">
                <span title="Easily link stretches and activities to materials using an intuitive card interface" style="cursor:help;color:#4f8cff;">&#9432;</span>
                <span>Link stretches and activities per material</span>
            </div>
            <div style="background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 12px; padding: 12px 14px; margin-bottom: 16px; display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
                <span style="font-size: 13px; color: #94a3b8; font-weight: 600;">üõ£Ô∏è Select Stretch First</span>
                <select id="stretchGateSelect" style="min-width: 240px; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(148, 163, 184, 0.3); background: rgba(30, 41, 59, 0.7); color: #e2e8f0;">
                    <option value="">Select a stretch‚Ä¶</option>
                    {% for s in all_stretches %}
                        <option value="{{ s.id }}">{{ s.stretch_name }}</option>
                    {% endfor %}
                </select>
                <button id="autoAssignBtn" type="button" class="btn-secondary" style="border-radius: 8px; padding: 8px 14px;">Auto-assign to other stretches</button>
                <span id="stretchGateHint" style="font-size: 12px; color: #94a3b8;">Choose a stretch to enable linking.</span>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; margin-bottom: 12px;">
        {% for material in materials %}
        <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 20px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; cursor: pointer;" onmouseenter="this.style.boxShadow='0 8px 32px rgba(79, 140, 255, 0.2)'; this.style.borderColor='rgba(79, 140, 255, 0.4)'" onmouseleave="this.style.boxShadow='0 4px 16px rgba(0, 0, 0, 0.1)'; this.style.borderColor='var(--border-color)'">
            <!-- Material Name Header -->
            <div style="margin-bottom: 16px; border-bottom: 2px solid rgba(79, 140, 255, 0.3); padding-bottom: 12px;">
                <h4 style="margin: 0; color: #4f8cff; font-size: 16px; font-weight: 700;">
                    üì¶ {{ material.name }}
                </h4>
            </div>
            
            <!-- Stretches Section -->
            <div style="margin-bottom: 16px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                    <span style="color: #22c55e; font-size: 14px; font-weight: 600;">üõ£Ô∏è Stretches</span>
                    <span style="font-size: 12px; color: #94a3b8; background: rgba(34, 197, 94, 0.1); padding: 2px 8px; border-radius: 12px;">
                        {% if material.stretches %}{{ material.stretches|length }}{% else %}0{% endif %} linked
                    </span>
                </div>
                <div style="min-height: 40px; display: flex; flex-wrap: wrap; gap: 6px; align-items: center;">
                    {% if material.stretches %}
                        {% for stretch in material.stretches %}
                            <span style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: #fff; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 500; box-shadow: 0 2px 6px rgba(34, 197, 94, 0.3);">
                                {{ stretch.stretch_name }}
                            </span>
                        {% endfor %}
                    {% else %}
                        <span style="color: #64748b; font-size: 12px; font-style: italic;">No stretches linked yet</span>
                    {% endif %}
                </div>
            </div>
            
            <!-- Activities Section -->
            <div style="margin-bottom: 16px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                    <span style="color: #a855f7; font-size: 14px; font-weight: 600;">‚öôÔ∏è Activities</span>
                    <span style="font-size: 12px; color: #94a3b8; background: rgba(168, 85, 247, 0.1); padding: 2px 8px; border-radius: 12px;">
                        {% if material.activities %}{{ material.activities|length }}{% else %}0{% endif %} linked
                    </span>
                </div>
                <div style="min-height: 40px; display: flex; flex-wrap: wrap; gap: 6px; align-items: center;">
                    {% if material.activities %}
                        {% for activity in material.activities %}
                            <span style="background: linear-gradient(135deg, #a855f7 0%, #7e22ce 100%); color: #fff; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 500; box-shadow: 0 2px 6px rgba(168, 85, 247, 0.3);">
                                {{ activity.name }}
                            </span>
                        {% endfor %}
                    {% else %}
                        <span style="color: #64748b; font-size: 12px; font-style: italic;">No activities linked yet</span>
                    {% endif %}
                </div>
            </div>
            
            <!-- Edit Button -->
            <div style="margin-top: 16px; border-top: 1px solid rgba(79, 140, 255, 0.2); padding-top: 12px;">
                <button 
                    onclick="openStretchActivityModal('{{ material.id }}', '{{ material.name }}')" 
                    class="configure-links-btn"
                    style="width: 100%; background: linear-gradient(135deg, #4f8cff 0%, #3a6fd8 100%); color: #fff; border: none; border-radius: 8px; padding: 10px 16px; font-weight: 600; cursor: pointer; font-size: 14px; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(79, 140, 255, 0.3);"
                    onmouseenter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(79, 140, 255, 0.5)'"
                    onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(79, 140, 255, 0.3)'">
                    ‚úèÔ∏è Configure Links
                </button>
            </div>
        </div>
        {% endfor %}
            </div>
        </div>
    </details>

        <!-- Vendor Modal - Improved Checkbox Interface -->
        <div id="vendorModal" class="modal" style="display:none;">
            <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
                <span class="close" onclick="closeVendorModal()">&times;</span>
                <h3 style="margin-top: 0; margin-bottom: 24px; color: #4f8cff;">
                    üè¢ Select Vendors for Material
                </h3>
                
                <div style="background: rgba(79, 140, 255, 0.05); border-left: 4px solid #4f8cff; padding: 12px 16px; border-radius: 8px; margin-bottom: 24px;">
                    <p style="margin: 0; color: #cbd5e1; font-size: 14px;">
                        <strong>Material:</strong> <span id="vendorModalMaterialName" style="color: #4f8cff; font-weight: 600;"></span>
                    </p>
                </div>
                
                <form id="vendorForm">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
                        <span style="color: #a8b3cf; font-weight: 600; font-size: 14px;">üìã Linked Vendors</span>
                        <span id="vendorCount" style="font-size: 12px; color: #94a3b8; background: rgba(59, 130, 246, 0.1); padding: 2px 8px; border-radius: 12px;">0 selected</span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; margin-bottom: 24px;">
                        <!-- Vendors will be populated by JavaScript -->
                    </div>
                    
                    <div class="modal-warning" id="vendorModalWarning" style="display:none; color: #ef4444; background: rgba(239, 68, 68, 0.1); border-left: 4px solid #ef4444; padding: 12px 16px; border-radius: 8px; margin-bottom: 16px; font-size: 14px;"></div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" onclick="closeVendorModal()" style="background: #64748b; border: none; border-radius: 8px; padding: 10px 20px; color: #fff; font-weight: 500; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='#475569'" onmouseout="this.style.background='#64748b'">Cancel</button>
                        <button type="submit" style="background: linear-gradient(135deg, #4f8cff 0%, #3a6fd8 100%); border: none; border-radius: 8px; padding: 10px 20px; color: #fff; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(79, 140, 255, 0.3); transition: all 0.3s ease;" onmouseover="this.style.boxShadow='0 6px 20px rgba(79, 140, 255, 0.5)'" onmouseout="this.style.boxShadow='0 4px 12px rgba(79, 140, 255, 0.3)'">Save Vendors</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Stretch & Activity Modal - Improved UI -->
        <div id="stretchActivityModal" class="modal" style="display:none;">
            <div class="modal-content modal-content--linker">
                <button class="modal-close" type="button" onclick="closeStretchActivityModal()" aria-label="Close">√ó</button>
                <div class="modal-header">
                    <div>
                        <div class="modal-title">üîó Link Material to Stretches & Activities</div>
                        <div class="modal-subtitle">Select where this material will be used.</div>
                    </div>
                    <div class="modal-pill">
                        <span class="pill-label">Material</span>
                        <span id="stretchActivityModalMaterialName" class="pill-value"></span>
                    </div>
                </div>
                
                <form id="stretchActivityForm">
                    <div class="modal-scroll">
                        <!-- Stretches Section -->
                        <div class="modal-section">
                            <div class="modal-section-header modal-section-header--stretch">
                                <div class="modal-section-title">üõ£Ô∏è Road Stretches</div>
                                <div class="modal-count"><span id="stretchCount">0</span> selected</div>
                            </div>
                            
                            <div class="modal-grid modal-grid--stretch">
                                {% for s in all_stretches %}
                                <label class="select-card select-card--stretch">
                                    <input type="checkbox" name="stretches" value="{{ s.id }}" onchange="updateStretchCount()">
                                    <span class="select-card__text">{{ s.stretch_name }}</span>
                                </label>
                                {% endfor %}
                            </div>
                            {% if not all_stretches %}
                            <div class="modal-empty">No stretches available</div>
                            {% endif %}
                        </div>
                        
                        <!-- Activities Section -->
                        <div class="modal-section" id="activitySection">
                            <div class="modal-section-header modal-section-header--activity">
                                <div class="modal-section-title">‚öôÔ∏è Activities</div>
                                <div class="modal-count"><span id="activityCount">0</span> selected</div>
                            </div>
                            <div class="modal-hint" id="activityGateHint">Select at least one stretch to enable activities.</div>
                            
                            <div class="modal-grid modal-grid--activity">
                                {% for a in all_activities %}
                                <label class="select-card select-card--activity">
                                    <input type="checkbox" name="activities" value="{{ a.id }}" onchange="updateActivityCount()">
                                    <span class="select-card__text">{{ a.name }}</span>
                                </label>
                                {% endfor %}
                            </div>
                            {% if not all_activities %}
                            <div class="modal-empty">No activities available</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <div class="modal-warning" id="stretchActivityModalWarning" style="display:none;"></div>
                        <div class="modal-actions">
                            <button type="button" class="btn-secondary" onclick="closeStretchActivityModal()">Cancel</button>
                            <button type="submit" class="btn-primary" id="stretchActivitySubmit">‚úì Save Links</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <style>
        .badge-vendor { background: #3b82f6; color: #fff; border-radius: 8px; padding: 2px 10px; margin: 0 2px 2px 0; display: inline-block; }
        .badge-stretch { background: #22c55e; color: #fff; border-radius: 8px; padding: 2px 10px; margin: 0 2px 2px 0; display: inline-block; }
        .badge-activity { background: #a855f7; color: #fff; border-radius: 8px; padding: 2px 10px; margin: 0 2px 2px 0; display: inline-block; }
        .badge-empty { background: #64748b; color: #fff; border-radius: 8px; padding: 2px 10px; margin: 0 2px 2px 0; display: inline-block; }
        .modal { position: fixed; z-index: 1000; left: 0; top: 0; width: 100vw; height: 100vh; overflow: auto; background: rgba(0,0,0,0.45); display: none; align-items: center; justify-content: center; opacity: 0; pointer-events: none; }
        .modal.show { display: flex !important; opacity: 1 !important; pointer-events: auto !important; z-index: 2000 !important; }
        .modal-content { background: var(--card-bg); padding: 28px 32px 24px 32px; border-radius: 16px; min-width: 340px; max-width: 98vw; box-shadow: 0 24px 64px rgba(0,0,0,0.35); position: relative; color: var(--text-primary); border: 1px solid rgba(79, 140, 255, 0.15); }
        .close { position: absolute; right: 18px; top: 12px; font-size: 22px; color: var(--text-secondary); cursor: pointer; }
        .modal-content--linker { width: min(900px, 92vw); padding: 24px 26px 18px; }
        .modal-close { position: absolute; right: 16px; top: 14px; width: 34px; height: 34px; border-radius: 10px; border: 1px solid rgba(148, 163, 184, 0.2); background: rgba(15, 23, 42, 0.7); color: #e2e8f0; font-size: 20px; cursor: pointer; transition: all 0.2s ease; }
        .modal-close:hover { background: rgba(79, 140, 255, 0.2); border-color: rgba(79, 140, 255, 0.5); }
        .modal-header { display: flex; align-items: center; justify-content: space-between; gap: 16px; padding-bottom: 12px; border-bottom: 1px solid rgba(79, 140, 255, 0.15); margin-bottom: 16px; }
        .modal-title { font-size: 18px; font-weight: 700; color: #e2e8f0; }
        .modal-subtitle { font-size: 12px; color: #94a3b8; margin-top: 4px; }
        .modal-pill { display: flex; align-items: center; gap: 10px; background: rgba(79, 140, 255, 0.12); border: 1px solid rgba(79, 140, 255, 0.3); padding: 8px 12px; border-radius: 999px; }
        .pill-label { font-size: 11px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.04em; }
        .pill-value { color: #4f8cff; font-weight: 700; font-size: 13px; }
        .modal-scroll { max-height: 62vh; overflow: auto; padding-right: 6px; display: grid; gap: 18px; }
        .modal-section { background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(148, 163, 184, 0.12); border-radius: 14px; padding: 16px; }
        .modal-section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
        .modal-section-title { font-weight: 700; color: #e2e8f0; }
        .modal-section-header--stretch .modal-section-title { color: #22c55e; }
        .modal-section-header--activity .modal-section-title { color: #a855f7; }
        .modal-count { font-size: 12px; color: #94a3b8; background: rgba(148, 163, 184, 0.15); padding: 4px 10px; border-radius: 999px; }
        .modal-hint { font-size: 12px; color: #94a3b8; margin: 4px 0 10px; }
        .is-disabled { opacity: 0.5; filter: grayscale(0.3); pointer-events: none; }
        .modal-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; }
        .select-card { display: flex; align-items: center; gap: 10px; padding: 12px; border-radius: 12px; border: 1px solid rgba(148, 163, 184, 0.15); background: rgba(30, 41, 59, 0.6); cursor: pointer; transition: all 0.2s ease; }
        .select-card input { width: 16px; height: 16px; cursor: pointer; }
        .select-card__text { color: #cbd5e1; font-weight: 600; font-size: 13px; }
        .select-card--stretch:hover { border-color: rgba(34, 197, 94, 0.6); background: rgba(34, 197, 94, 0.08); }
        .select-card--activity:hover { border-color: rgba(168, 85, 247, 0.6); background: rgba(168, 85, 247, 0.08); }
        .modal-empty { color: #64748b; font-style: italic; padding: 12px; text-align: center; background: rgba(30, 41, 59, 0.3); border-radius: 10px; }
        .modal-footer { display: flex; align-items: center; justify-content: space-between; gap: 16px; margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(79, 140, 255, 0.15); }
        .modal-warning { color: #fecaca; background: rgba(239, 68, 68, 0.12); border: 1px solid rgba(239, 68, 68, 0.35); padding: 10px 12px; border-radius: 10px; font-size: 12px; }
        .modal-actions { display: flex; gap: 10px; margin-left: auto; }
        .btn-info.btn-sm, .btn-add-vendor { background: #3b82f6; color: #fff; border: none; border-radius: 7px; padding: 6px 14px; font-size: 13px; cursor: pointer; }
        .btn-info.btn-sm:hover, .btn-add-vendor:hover { filter: brightness(1.08); }
        </style>

        <script>
        let currentMaterialId = null;
        function openVendorModal(materialId, materialName) {
            const modal = document.getElementById('vendorModal');
            if (!modal) {
                console.error('Vendor modal not found');
                return;
            }
            modal.classList.add('show');
            document.getElementById('vendorModalMaterialName').textContent = materialName;
            currentMaterialId = materialId;
            
            // Clear any previous vendor checkboxes
            const vendorGrid = document.querySelector('#vendorForm > div:nth-child(2)');
            if (vendorGrid) {
                vendorGrid.innerHTML = '';
            }
            
            // Fetch vendors linked to this material only
            fetch(`/material/${materialId}/vendors`)
                .then(r => r.json())
                .then(data => {
                    const linkedIds = Array.isArray(data.vendor_ids) ? data.vendor_ids : [];
                    const vendors = Array.isArray(data.vendors) ? data.vendors : [];
                    const vendorGrid = document.querySelector('#vendorForm > div:nth-child(2)');
                    if (vendorGrid && vendors.length > 0) {
                        vendorGrid.innerHTML = vendors.map(vendor => `
                            <label style="background: rgba(30, 41, 59, 0.8); border: 2px solid rgba(79, 140, 255, 0.1); border-radius: 12px; padding: 14px; cursor: pointer; transition: all 0.3s ease; display: flex; flex-direction: column; gap: 8px;" onmouseover="this.style.borderColor='rgba(79, 140, 255, 0.4)'; this.style.background='rgba(30, 41, 59, 0.95)'; this.style.boxShadow='0 4px 12px rgba(79, 140, 255, 0.15)'" onmouseout="this.style.borderColor='rgba(79, 140, 255, 0.1)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='none'">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" name="vendors" value="${vendor.id}" style="width: 18px; height: 18px; cursor: pointer;" onchange="updateVendorCount()" ${linkedIds.includes(vendor.id) ? 'checked' : ''}>
                                    <span style="color: #4f8cff; font-weight: 600; flex: 1;">${vendor.vendor_name}</span>
                                </div>
                                <div style="font-size: 12px; color: #94a3b8; display: grid; gap: 4px;">
                                    <div>üë§ <span>${vendor.contact_person || 'N/A'}</span></div>
                                    <div>üìß <span>${vendor.email || 'N/A'}</span></div>
                                    <div style="background: rgba(168, 85, 247, 0.1); padding: 4px 6px; border-radius: 6px;">‚è±Ô∏è Lead Time: <span style="color: #a855f7; font-weight: 600;">${vendor.lead_time_days}d</span></div>
                                </div>
                            </label>
                        `).join('');
                        updateVendorCount();
                    } else if (vendorGrid) {
                        vendorGrid.innerHTML = '<div style="grid-column: 1 / -1; padding: 20px; text-align: center; color: #94a3b8;">No vendors linked to this material yet. Add vendors for this material first.</div>';
                    }
                }).catch(err => {
                    console.error('Error fetching vendors:', err);
                });
        }
        function closeVendorModal() {
            const modal = document.getElementById('vendorModal');
            if (modal) {
                modal.classList.remove('show');
            }
            currentMaterialId = null;
        }
        function openStretchActivityModal(materialId, materialName) {
            const modal = document.getElementById('stretchActivityModal');
            if (!modal) {
                console.error('Stretch/Activity modal not found');
                return;
            }
            const selectedStretchId = getSelectedStretchId();
            if (!selectedStretchId) {
                showNotification('Please select a stretch first.', 'error');
                return;
            }
            modal.classList.add('show');
            document.getElementById('stretchActivityModalMaterialName').textContent = materialName;
            currentMaterialId = materialId;
            
            // Reset all checkboxes
            document.querySelectorAll('#stretchActivityForm input[type="checkbox"]').forEach(cb => cb.checked = false);
            updateStretchCount();
            updateActivityCount();
            
            // Fetch and pre-select stretches
            fetch(`/material/${materialId}/stretches`).then(r => r.json()).then(data => {
                document.querySelectorAll('#stretchActivityForm input[name="stretches"]').forEach(cb => {
                    cb.checked = data.stretch_ids.includes(parseInt(cb.value));
                });
                // Ensure selected stretch is checked
                document.querySelectorAll('#stretchActivityForm input[name="stretches"]').forEach(cb => {
                    if (parseInt(cb.value) === selectedStretchId) cb.checked = true;
                });
                updateStretchCount();
            });
            
            // Fetch and pre-select activities
            fetch(`/material/${materialId}/activities`).then(r => r.json()).then(data => {
                document.querySelectorAll('#stretchActivityForm input[name="activities"]').forEach(cb => {
                    cb.checked = data.activity_ids.includes(parseInt(cb.value));
                });
                updateActivityCount();
            });
        }
        
        function closeStretchActivityModal() {
            const modal = document.getElementById('stretchActivityModal');
            if (modal) {
                modal.classList.remove('show');
            }
            currentMaterialId = null;
        }
        
        // Update selected vendor count
        function updateVendorCount() {
            const count = document.querySelectorAll('#vendorForm input[name="vendors"]:checked').length;
            document.getElementById('vendorCount').textContent = count + ' selected';
        }
        
        // Update selected stretch count
        function updateStretchCount() {
            const count = document.querySelectorAll('#stretchActivityForm input[name="stretches"]:checked').length;
            document.getElementById('stretchCount').textContent = count;
            toggleActivitiesEnabled(count > 0);
        }
        
        // Update selected activity count
        function updateActivityCount() {
            const count = document.querySelectorAll('#stretchActivityForm input[name="activities"]:checked').length;
            document.getElementById('activityCount').textContent = count;
        }

        function toggleActivitiesEnabled(enabled) {
            const section = document.getElementById('activitySection');
            const hint = document.getElementById('activityGateHint');
            const submitBtn = document.getElementById('stretchActivitySubmit');
            if (!section) return;
            if (enabled) {
                section.classList.remove('is-disabled');
                if (hint) hint.style.display = 'none';
                if (submitBtn) submitBtn.disabled = false;
            } else {
                section.classList.add('is-disabled');
                if (hint) hint.style.display = 'block';
                if (submitBtn) submitBtn.disabled = true;
                document.querySelectorAll('#stretchActivityForm input[name="activities"]').forEach(cb => cb.checked = false);
                updateActivityCount();
            }
        }

        function getSelectedStretchId() {
            const select = document.getElementById('stretchGateSelect');
            if (!select) return null;
            const value = select.value ? parseInt(select.value) : null;
            return Number.isNaN(value) ? null : value;
        }

        function updateStretchGateState() {
            const selected = getSelectedStretchId();
            const buttons = document.querySelectorAll('.configure-links-btn');
            buttons.forEach(btn => {
                btn.disabled = !selected;
                btn.style.opacity = selected ? '1' : '0.5';
                btn.style.cursor = selected ? 'pointer' : 'not-allowed';
            });
            const autoAssignBtn = document.getElementById('autoAssignBtn');
            if (autoAssignBtn) {
                autoAssignBtn.disabled = !selected;
                autoAssignBtn.style.opacity = selected ? '1' : '0.6';
                autoAssignBtn.style.cursor = selected ? 'pointer' : 'not-allowed';
            }
            const hint = document.getElementById('stretchGateHint');
            if (hint) hint.textContent = selected ? 'Stretch selected. You can link materials and activities.' : 'Choose a stretch to enable linking.';
        }

        // Modal form submit handlers (AJAX, validation)
        document.addEventListener('DOMContentLoaded', function() {
            const stretchGateSelect = document.getElementById('stretchGateSelect');
            if (stretchGateSelect) {
                stretchGateSelect.addEventListener('change', updateStretchGateState);
                updateStretchGateState();
            }
            const autoAssignBtn = document.getElementById('autoAssignBtn');
            if (autoAssignBtn) {
                autoAssignBtn.addEventListener('click', function() {
                    const selectedStretchId = getSelectedStretchId();
                    if (!selectedStretchId) {
                        showNotification('Please select a stretch first.', 'error');
                        return;
                    }
                    autoAssignBtn.disabled = true;
                    const originalText = autoAssignBtn.textContent;
                    autoAssignBtn.textContent = 'Auto-assigning...';
                    fetch(`/project/{{ project.id }}/stretches/${selectedStretchId}/auto-assign-materials`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({})
                    })
                    .then(r => r.json())
                    .then(data => {
                        if (data.success) {
                            showNotification(data.message || 'Auto-assignment completed.', 'success');
                            setTimeout(() => location.reload(), 800);
                        } else {
                            showNotification(data.error || 'Auto-assignment failed.', 'error');
                            autoAssignBtn.disabled = false;
                            autoAssignBtn.textContent = originalText;
                        }
                    })
                    .catch(err => {
                        showNotification(err.message || 'Auto-assignment failed.', 'error');
                        autoAssignBtn.disabled = false;
                        autoAssignBtn.textContent = originalText;
                    });
                });
            }
            document.getElementById('vendorForm').onsubmit = function(e) {
                e.preventDefault();
                var selected = Array.from(document.querySelectorAll('#vendorForm input[name="vendors"]:checked')).map(cb => cb.value);
                if (selected.length === 0) {
                    document.getElementById('vendorModalWarning').textContent = '‚ö†Ô∏è Please select at least one vendor.';
                    document.getElementById('vendorModalWarning').style.display = 'block';
                    return false;
                }
                document.getElementById('vendorModalWarning').style.display = 'none';
                
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = 'Saving...';
                
                // Send vendor selections to backend
                fetch(`/material/${currentMaterialId}/vendors`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ vendor_ids: selected })
                }).then(r => r.json()).then(data => {
                    if (data.success) {
                        showNotification('Vendors updated successfully!', 'success');
                        setTimeout(() => location.reload(), 800);
                    } else {
                        document.getElementById('vendorModalWarning').textContent = '‚ùå Error: ' + (data.error || 'Failed to update vendors');
                        document.getElementById('vendorModalWarning').style.display = 'block';
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalText;
                    }
                }).catch(err => {
                    console.error('Error:', err);
                    document.getElementById('vendorModalWarning').textContent = '‚ùå Error: ' + err.message;
                    document.getElementById('vendorModalWarning').style.display = 'block';
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                });
                
                return false;
            };
            document.getElementById('stretchActivityForm').onsubmit = function(e) {
                e.preventDefault();
                var stretches = Array.from(document.querySelectorAll('#stretchActivityForm input[name="stretches"]:checked')).map(cb => parseInt(cb.value));
                var activities = Array.from(document.querySelectorAll('#stretchActivityForm input[name="activities"]:checked')).map(cb => parseInt(cb.value));
                
                if (stretches.length === 0) {
                    document.getElementById('stretchActivityModalWarning').textContent = '‚ö†Ô∏è Please select at least one stretch first.';
                    document.getElementById('stretchActivityModalWarning').style.display = 'block';
                    return false;
                }
                
                document.getElementById('stretchActivityModalWarning').style.display = 'none';
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = 'Saving...';
                
                // Save stretches
                fetch(`/material/${currentMaterialId}/stretches`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ stretch_ids: stretches })
                })
                .then(r => r.json())
                .then(data => {
                    // Save activities
                    return fetch(`/material/${currentMaterialId}/activities`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ activity_ids: activities })
                    });
                })
                .then(r => r.json())
                .then(data => {
                    showNotification('Links saved successfully!', 'success');
                    setTimeout(() => {
                        closeStretchActivityModal();
                        window.location.reload();
                    }, 800);
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('stretchActivityModalWarning').textContent = '‚ùå Error saving links. Please try again.';
                    document.getElementById('stretchActivityModalWarning').style.display = 'block';
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                });
                
                return false;
            };
        });
        </script>
        </tbody>
    </table>

    <!-- Inventory Intelligence - Card Grid -->
    <details class="collapsible-section">
        <summary>
            <span>üìä Inventory Status</span>
            <span class="chevron">‚ñº</span>
        </summary>
        <div class="section-body">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px;color:var(--text-secondary);font-size:12px;">
                <span title="Current stock levels for all materials" style="cursor:help;color:#4f8cff;">&#9432;</span>
                <span>Current stock levels</span>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 20px; margin-bottom: 12px;">
        {% for material in materials %}
        <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 20px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); transition: all 0.3s ease;" onmouseenter="this.style.boxShadow='0 8px 32px rgba(79, 140, 255, 0.2)'; this.style.borderColor='rgba(79, 140, 255, 0.4)'" onmouseleave="this.style.boxShadow='0 4px 16px rgba(0, 0, 0, 0.1)'; this.style.borderColor='var(--border-color)'">
            
            <!-- Material Name Header -->
            <div style="margin-bottom: 16px; border-bottom: 2px solid rgba(79, 140, 255, 0.3); padding-bottom: 12px;">
                <h4 style="margin: 0; color: #4f8cff; font-size: 16px; font-weight: 700;">
                    üì¶ {{ material.name }}
                </h4>
            </div>
            
            <!-- Inventory Metrics Grid -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                <!-- Opening Stock -->
                <div style="background: rgba(34, 197, 94, 0.05); border: 1px solid rgba(34, 197, 94, 0.1); border-radius: 10px; padding: 12px;">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">üì• Opening</div>
                    <div style="font-size: 20px; font-weight: 700; color: #22c55e;">{{ material.opening_stock or '0' }}</div>
                </div>
                
                <!-- Incoming Stock -->
                <div style="background: rgba(59, 130, 246, 0.05); border: 1px solid rgba(59, 130, 246, 0.1); border-radius: 10px; padding: 12px;">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">üì¶ Incoming</div>
                    <div style="font-size: 20px; font-weight: 700; color: #3b82f6;">{{ material.incoming_stock or '0' }}</div>
                </div>
                
                <!-- Issued Stock -->
                <div style="background: rgba(168, 85, 247, 0.05); border: 1px solid rgba(168, 85, 247, 0.1); border-radius: 10px; padding: 12px;">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">üì§ Issued</div>
                    <div style="font-size: 20px; font-weight: 700; color: #a855f7;">{{ material.issued_stock or '0' }}</div>
                </div>
                
                <!-- Closing Stock -->
                <div style="background: rgba(236, 72, 153, 0.05); border: 1px solid rgba(236, 72, 153, 0.1); border-radius: 10px; padding: 12px;">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">üíæ Closing</div>
                    <div style="font-size: 20px; font-weight: 700; color: #ec4899;">{{ material.closing_stock or '0' }}</div>
                </div>
            </div>
            
            <!-- Status Badge -->
            <div style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.05) 100%); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 10px; padding: 12px; text-align: center;">
                <span style="color: #22c55e; font-weight: 600; font-size: 14px;">‚úÖ Status: Balanced</span>
            </div>
        </div>
        {% endfor %}
            </div>
        </div>
    </details>

    <!-- Procurement Intelligence - Card Grid -->
    <details class="collapsible-section">
        <summary>
            <span>üìã Procurement Planning</span>
            <span class="chevron">‚ñº</span>
        </summary>
        <div class="section-body">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px;color:var(--text-secondary);font-size:12px;">
                <span title="Manage procurement schedules and suggest vendors" style="cursor:help;color:#4f8cff;">&#9432;</span>
                <span>Manage procurement schedules</span>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 20px; margin-bottom: 12px;">
        {% for material in materials %}
        <div style="background: var(--card-bg); border: 1px solid rgba(168, 85, 247, 0.2); border-radius: 16px; padding: 20px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); transition: all 0.3s ease;" onmouseenter="this.style.boxShadow='0 8px 32px rgba(168, 85, 247, 0.2)'; this.style.borderColor='rgba(168, 85, 247, 0.4)'" onmouseleave="this.style.boxShadow='0 4px 16px rgba(0, 0, 0, 0.1)'; this.style.borderColor='rgba(168, 85, 247, 0.2)'">
            
            <!-- Material Name Header -->
            <div style="margin-bottom: 16px; border-bottom: 2px solid rgba(168, 85, 247, 0.3); padding-bottom: 12px;">
                <h4 style="margin: 0; color: #a855f7; font-size: 16px; font-weight: 700;">
                    üì¶ {{ material.name }}
                </h4>
            </div>
            
            <!-- Procurement Details Grid -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                <!-- Min Stock -->
                <div style="background: rgba(168, 85, 247, 0.05); border: 1px solid rgba(168, 85, 247, 0.1); border-radius: 10px; padding: 12px;">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">üìç Min Stock</div>
                    <div style="font-size: 18px; font-weight: 700; color: #a855f7;">{{ material.minimum_stock or '-' }}</div>
                </div>
                
                <!-- Buffer Stock -->
                <div style="background: rgba(236, 72, 153, 0.05); border: 1px solid rgba(236, 72, 153, 0.1); border-radius: 10px; padding: 12px;">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">üõ°Ô∏è Buffer</div>
                    <div style="font-size: 18px; font-weight: 700; color: #ec4899;">{{ material.buffer_stock or '-' }}</div>
                </div>
                
                <!-- Lead Time -->
                <div style="background: rgba(59, 130, 246, 0.05); border: 1px solid rgba(59, 130, 246, 0.1); border-radius: 10px; padding: 12px;">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">‚è±Ô∏è Lead Time</div>
                    <div style="font-size: 18px; font-weight: 700; color: #3b82f6;">{{ material.lead_time_days or '0' }}d</div>
                </div>
                
                <!-- Next Procurement -->
                <div style="background: rgba(34, 197, 94, 0.05); border: 1px solid rgba(34, 197, 94, 0.1); border-radius: 10px; padding: 12px;">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">üìÖ Next Order</div>
                    <div style="font-size: 14px; font-weight: 700; color: #22c55e;">{{ material.next_procurement_date or 'TBD' }}</div>
                </div>
            </div>
            
            <!-- Suggested Vendor -->
            <div style="background: rgba(34, 197, 94, 0.08); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 10px; padding: 12px; margin-bottom: 16px;">
                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">üè¢ Suggested Vendor</div>
                <div style="color: #22c55e; font-weight: 600; font-size: 14px;">{{ material.suggested_vendor or 'No vendor assigned' }}</div>
            </div>
            
            <!-- Action Button -->
            <button style="width: 100%; background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); color: #fff; border: none; border-radius: 10px; padding: 12px 16px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);" onmouseover="this.style.boxShadow='0 6px 20px rgba(168, 85, 247, 0.5)'" onmouseout="this.style.boxShadow='0 4px 12px rgba(168, 85, 247, 0.3)'">
                ‚úèÔ∏è Edit Procurement
            </button>
        </div>
        {% endfor %}
            </div>
        </div>
    </details>

    <!-- Alerts & Intelligence - Card Grid -->
    <h3>
        üö® Alerts & Intelligence
        <span title="Critical alerts and recommendations" style="cursor:help;font-size:16px;color:#4f8cff;vertical-align:middle;">&#9432;</span>
    </h3>
    {% if alerts %}
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 20px; margin-bottom: 48px;">
        {% for alert in alerts %}
        <div style="background: var(--card-bg); border: 1px solid {% if alert.type == 'critical' %}rgba(239, 68, 68, 0.2){% elif alert.type == 'warning' %}rgba(245, 158, 11, 0.2){% else %}rgba(34, 197, 94, 0.2){% endif %}; border-radius: 16px; padding: 20px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); transition: all 0.3s ease;" onmouseenter="this.style.boxShadow='0 8px 32px {% if alert.type == 'critical' %}rgba(239, 68, 68, 0.2){% elif alert.type == 'warning' %}rgba(245, 158, 11, 0.2){% else %}rgba(34, 197, 94, 0.2){% endif %}'" onmouseleave="this.style.boxShadow='0 4px 16px rgba(0, 0, 0, 0.1)'"><!-- Alert Type Badge -->
            
            <!-- Alert Type Badge -->
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 2px solid {% if alert.type == 'critical' %}rgba(239, 68, 68, 0.3){% elif alert.type == 'warning' %}rgba(245, 158, 11, 0.3){% else %}rgba(34, 197, 94, 0.3){% endif %};">
                <span style="font-weight: 600; color: {% if alert.type == 'critical' %}#ef4444{% elif alert.type == 'warning' %}#f59e0b{% else %}#22c55e{% endif %}; font-size: 14px;">
                    {% if alert.type == 'critical' %}üî¥ CRITICAL{% elif alert.type == 'warning' %}üü° WARNING{% else %}üü¢ INFO{% endif %}
                </span>
            </div>
            
            <!-- Alert Material -->
            <div style="margin-bottom: 12px;">
                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;">Material</div>
                <div style="color: var(--text-primary); font-weight: 600;">{{ alert.material }}</div>
            </div>
            
            <!-- Alert Message -->
            <div style="margin-bottom: 12px;">
                <div style="font-size: 12px; color: #94a3b8; margin-bottom: 4px; font-weight: 600;">Message</div>
                <div style="color: #cbd5e1; font-size: 14px; line-height: 1.5;">{{ alert.message }}</div>
            </div>
            
            <!-- Alert Date -->
            <div style="margin-bottom: 16px;">
                <div style="font-size: 12px; color: #94a3b8;">üìÖ {{ alert.date }}</div>
            </div>
            
            <!-- Action Button -->
            <button style="width: 100%; background: linear-gradient(135deg, {% if alert.type == 'critical' %}#ef4444{% elif alert.type == 'warning' %}#f59e0b{% else %}#22c55e{% endif %} 0%, {% if alert.type == 'critical' %}#dc2626{% elif alert.type == 'warning' %}#d97706{% else %}#16a34a{% endif %} 100%); color: #fff; border: none; border-radius: 10px; padding: 10px 16px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                {{ alert.action or '‚úÖ Acknowledge' }}
            </button>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.05) 100%); border: 2px dashed rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 40px 20px; text-align: center; margin-bottom: 48px;">
        <div style="font-size: 48px; margin-bottom: 12px;">‚úÖ</div>
        <div style="color: #22c55e; font-weight: 600; font-size: 16px; margin-bottom: 8px;">All Systems Green</div>
        <div style="color: #94a3b8; font-size: 14px;">No critical alerts at this time. Your inventory is healthy!</div>
    </div>
    {% endif %}

    <!-- Export Buttons -->
    <div style="margin-top:24px;">
        <button class="btn-secondary">Export to Excel</button>
        <button class="btn-secondary">Export to PDF</button>
    </div>
</div>

<!-- Add Material Modal -->
<div id="addMaterialModal" class="modal">
    <div class="modal-content" style="max-width: 95vw; width: 90vw; max-height: 90vh; margin: 0 auto; padding: 0; border-radius: 12px; overflow-y: auto; border: 2px solid rgba(79, 140, 255, 0.3); background: white;">
        <div style="position: sticky; top: 0; z-index: 10; background: linear-gradient(135deg, rgba(79, 140, 255, 0.08) 0%, rgba(79, 140, 255, 0.03) 100%); margin: 0; padding: 28px 40px; border-bottom: 2px solid rgba(79, 140, 255, 0.15); border-radius: 0;">
            <div style="display: flex; align-items: center; justify-content: space-between; gap: 16px;">
                <div style="display: flex; align-items: center; gap: 14px;">
                    <span style="font-size: 40px; background: linear-gradient(135deg, rgba(79, 140, 255, 0.15) 0%, rgba(79, 140, 255, 0.08) 100%); width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center; justify-content: center; border: 2px solid rgba(79, 140, 255, 0.2);">üì¶</span>
                    <div>
                        <h2 style="margin: 0; color: var(--text-primary); font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                            Add New Material
                            <span style="font-size: 10px; color: var(--text-secondary); background: rgba(79, 140, 255, 0.1); padding: 3px 10px; border-radius: 20px; font-weight: 600;">STEP BY STEP</span>
                        </h2>
                        <p style="margin: 4px 0 0 0; color: var(--text-secondary); font-size: 13px; line-height: 1.4;">Define materials, configure inventory settings, and link to activities</p>
                    </div>
                </div>
                <button class="close" onclick="closeAddMaterialModal()" style="position: static; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); width: 32px; height: 32px; border-radius: 8px; cursor: pointer; color: #ef4444; font-size: 24px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; flex-shrink: 0;" onmouseover="this.style.background='rgba(239, 68, 68, 0.2)'; this.style.borderColor='rgba(239, 68, 68, 0.5)'" onmouseout="this.style.background='rgba(239, 68, 68, 0.1)'; this.style.borderColor='rgba(239, 68, 68, 0.3)'">&times;</button>
            </div>
        </div>
        
        <form method="post" action="/project/{{ project.id }}/materials/add" id="addMaterialForm" style="padding: 40px;">
            <!-- Basic Information Section -->
            <div style="background: linear-gradient(135deg, rgba(79, 140, 255, 0.06) 0%, rgba(79, 140, 255, 0.02) 100%); border: 2px solid rgba(79, 140, 255, 0.15); border-left: 6px solid #4f8cff; padding: 28px; border-radius: 12px; margin-bottom: 36px; position: relative; overflow: hidden; box-shadow: 0 2px 8px rgba(79, 140, 255, 0.05);">
                <div style="position: absolute; top: -40px; right: -40px; width: 150px; height: 150px; background: radial-gradient(circle, rgba(79, 140, 255, 0.05) 0%, transparent 70%); border-radius: 50%;"></div>
                <div style="position: relative; z-index: 1;">
                    <div style="display: flex; align-items: center; gap: 14px; margin-bottom: 28px; padding-bottom: 20px; border-bottom: 2px solid rgba(79, 140, 255, 0.1);">
                        <span style="font-size: 32px; background: linear-gradient(135deg, rgba(79, 140, 255, 0.15) 0%, rgba(79, 140, 255, 0.08) 100%); padding: 8px 12px; border-radius: 10px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(79, 140, 255, 0.1);">üìã</span>
                        <h4 style="margin: 0; color: var(--text-primary); font-size: 20px; font-weight: 800; letter-spacing: 0.3px;">Basic Information</h4>
                        <span style="margin-left: auto; font-size: 12px; color: var(--text-primary); background: rgba(79, 140, 255, 0.1); padding: 6px 14px; border-radius: 20px; border: 1px solid rgba(79, 140, 255, 0.2); font-weight: 600;">1Ô∏è‚É£ Basic</span>
                    </div>
                    <div class="form-grid" style="display:grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 16px;">
                        <!-- Material Name - Full Width -->
                        <div style="grid-column: 1 / -1;">
                            <label for="modal_material_name" style="display:block;margin-bottom:10px;font-weight:600;color:var(--text-secondary);font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üì¶ Material Name <span style="color:#ef4444;">*</span></label>
                            <input type="text" id="modal_material_name" name="material_name" placeholder="e.g., OPC Cement, TMT Steel Bar, Fine Aggregate" required style="width: 100%; padding: 12px 16px; border-radius: 10px; border: 2px solid var(--border-color); background: var(--input-bg); color: var(--text-primary); font-size: 14px; font-weight: 500; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.6)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                            <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">Provide a descriptive name for easy identification</small>
                        </div>
                        <!-- Material Code & Category -->
                        <div>
                            <label for="modal_material_code" style="display:block;margin-bottom:10px;font-weight:600;color:var(--text-secondary);font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üîê Material Code</label>
                            <input type="text" id="modal_material_code" name="material_code" placeholder="Auto-generated" readonly style="width: 100%; padding: 12px 16px; border-radius: 10px; border: 2px solid var(--border-color); background: rgba(0, 0, 0, 0.02); color: var(--text-secondary); font-size: 14px; font-weight: 500; cursor: not-allowed;">
                            <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">Generated automatically</small>
                        </div>
                        <div>
                            <label for="modal_material_category" style="display:block;margin-bottom:10px;font-weight:600;color:var(--text-secondary);font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üè∑Ô∏è Category <span style="color:#ef4444;">*</span></label>
                            <select name="material_category" id="modal_material_category" required onchange="toggleCustomCategoryInput()" style="width: 100%; padding: 12px 16px; border-radius: 10px; border: 2px solid var(--border-color); background: var(--input-bg); color: var(--text-primary); font-size: 14px; font-weight: 500; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.6)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                                <option value="">Select Category</option>
                                <option value="Cement">Cement</option>
                                <option value="Aggregate">Aggregate</option>
                                <option value="Steel">Steel</option>
                                <option value="Sand">Sand</option>
                                <option value="Chemical">Chemical</option>
                                <option value="Other">Other (Custom)</option>
                            </select>
                        </div>
                        <!-- Custom Category Input -->
                        <div id="customCategoryDiv" style="display:none;">
                            <label for="modal_custom_category" style="display:block;margin-bottom:10px;font-weight:600;color:var(--text-secondary);font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">‚úèÔ∏è Custom Category</label>
                            <input type="text" name="custom_material_category" id="modal_custom_category" placeholder="Specify your custom category" style="width: 100%; padding: 12px 16px; border-radius: 10px; border: 2px solid var(--border-color); background: var(--input-bg); color: var(--text-primary); font-size: 14px; font-weight: 500; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.6)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                        </div>
                        <!-- Type & Unit -->
                        <div>
                            <label for="modal_type" style="display:block;margin-bottom:10px;font-weight:600;color:var(--text-secondary);font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üîÑ Material Type <span style="color:#ef4444;">*</span></label>
                            <select name="material_type" id="modal_type" required style="width: 100%; padding: 12px 16px; border-radius: 10px; border: 2px solid var(--border-color); background: var(--input-bg); color: var(--text-primary); font-size: 14px; font-weight: 500; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.6)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                                <option value="">Select Type</option>
                                <option value="Consumable">Consumable (Used up during project)</option>
                                <option value="Non-Consumable">Non-Consumable (Reusable/Salvageable)</option>
                            </select>
                        </div>
                        <div>
                            <label for="modal_unit" style="display:block;margin-bottom:10px;font-weight:600;color:var(--text-secondary);font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üìè Unit of Measurement <span style="color:#ef4444;">*</span></label>
                            <select name="unit" id="modal_unit" required style="width: 100%; padding: 12px 16px; border-radius: 10px; border: 2px solid var(--border-color); background: var(--input-bg); color: var(--text-primary); font-size: 14px; font-weight: 500; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.6)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                                <option value="">Select Unit</option>
                                <option value="Bags">Bags</option>
                                <option value="Kg">Kg (Kilogram)</option>
                                <option value="MT">MT (Metric Ton)</option>
                                <option value="Cum">Cum (Cubic Meter - m¬≥)</option>
                                <option value="Nos">Nos (Number/Pieces)</option>
                                <option value="Liters">Liters</option>
                            </select>
                        </div>
                        <!-- Specification & Consumption Type -->
                        <div>
                            <label for="modal_specification" style="display:block;margin-bottom:10px;font-weight:600;color:var(--text-secondary);font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üìä Specification / Grade</label>
                            <input type="text" id="modal_specification" name="specification" placeholder="e.g., OPC 43, Fe500, 20mm, 53 Grade" style="width: 100%; padding: 12px 16px; border-radius: 10px; border: 2px solid var(--border-color); background: var(--input-bg); color: var(--text-primary); font-size: 14px; font-weight: 500; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.6)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                            <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">Optional - used for vendor quotes</small>
                        </div>
                        <div>
                            <label for="modal_consumption_type" style="display:block;margin-bottom:10px;font-weight:600;color:var(--text-secondary);font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">‚öôÔ∏è Consumption Model <span style="color:#ef4444;">*</span></label>
                            <select name="consumption_type" id="modal_consumption_type" required style="width: 100%; padding: 12px 16px; border-radius: 10px; border: 2px solid var(--border-color); background: var(--input-bg); color: var(--text-primary); font-size: 14px; font-weight: 500; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.6)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'" onblur="this.style.borderColor='var(--border-color)'; this.style.boxShadow='none'">
                                <option value="">Select Model</option>
                                <option value="BOQ-based">üìã BOQ-based (Quantity from BOQ)</option>
                                <option value="Daily Consumption">üìÖ Daily Consumption (Per day rate)</option>
                                <option value="Lump Sum">üéØ Lump Sum (Fixed total)</option>
                            </select>
                        </div>
                    </div>
            </div>

            <!-- Mapping Section -->
            <div style="background: linear-gradient(135deg, rgba(148, 163, 184, 0.08) 0%, rgba(148, 163, 184, 0.03) 100%); border: 2px solid rgba(148, 163, 184, 0.2); border-left: 6px solid #94a3b8; padding: 28px; border-radius: 12px; margin-bottom: 36px; position: relative; overflow: hidden; box-shadow: 0 2px 8px rgba(148, 163, 184, 0.06);">
                <div style="position: absolute; top: -40px; right: -40px; width: 150px; height: 150px; background: radial-gradient(circle, rgba(34, 197, 94, 0.1) 0%, transparent 70%); border-radius: 50%;"></div>
                <div style="position: relative; z-index: 1;">
                    <div style="display: flex; align-items: center; gap: 14px; margin-bottom: 28px; padding-bottom: 20px; border-bottom: 2px solid rgba(148, 163, 184, 0.15);">
                        <span style="font-size: 32px; background: linear-gradient(135deg, #64748b 0%, #475569 100%); padding: 8px 12px; border-radius: 10px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(148, 163, 184, 0.3);">üîó</span>
                        <h4 style="margin: 0; color: #e2e8f0; font-size: 20px; font-weight: 800; letter-spacing: 0.3px;">Map to Activities & Stretches</h4>
                        <span style="margin-left: auto; font-size: 12px; color: #e2e8f0; background: linear-gradient(135deg, rgba(148, 163, 184, 0.2) 0%, rgba(148, 163, 184, 0.1) 100%); padding: 6px 14px; border-radius: 20px; border: 1px solid rgba(148, 163, 184, 0.3); font-weight: 600;">2Ô∏è‚É£ Mapping</span>
                    </div>
                    <div class="form-grid" style="display:grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 16px;">
                        <!-- Activities Dropdown -->
                        <div>
                            <label style="display:block;margin-bottom:10px;font-weight:600;color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üéØ Map to Activities <span style="color:#ef4444;">*</span></label>
                            <div onclick="toggleActivityDropdown()" style="width: 100%; padding: 14px 16px; border-radius: 12px; border: 2px solid rgba(148, 163, 184, 0.25); background: linear-gradient(135deg, rgba(30,41,59,0.7) 0%, rgba(30,41,59,0.5) 100%); color: #fff; font-size: 14px; font-weight: 500; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(148,163,184,0.5)'; this.style.boxShadow='0 0 12px rgba(148,163,184,0.15)'" onmouseout="this.style.borderColor='rgba(148,163,184,0.25)'; this.style.boxShadow='none'">
                                <span id="activityDropdownLabel">Select activities...</span>
                                <span id="activityDropdownIcon" style="transition: transform 0.3s; font-size: 16px;">‚ñº</span>
                            </div>
                            <div id="activityDropdownList" style="display: none; margin-top: 8px; border: 2px solid rgba(148, 163, 184, 0.25); border-radius: 12px; background: linear-gradient(135deg, rgba(30,41,59,0.8) 0%, rgba(30,41,59,0.6) 100%); max-height: 280px; overflow-y: auto; box-shadow: 0 4px 12px rgba(148, 163, 184, 0.15);">
                                {% for activity in activities %}
                                <label style="display: flex; align-items: center; padding: 12px 14px; cursor: pointer; border-bottom: 1px solid rgba(148, 163, 184, 0.12); transition: all 0.2s ease;" onmouseover="this.style.background='rgba(148, 163, 184, 0.08)'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" name="activity_mapping" value="{{ activity.id }}" style="margin-right: 10px; cursor: pointer; width: 18px; height: 18px; accent-color: #94a3b8;">
                                    <span style="color: #cbd5e1; font-size: 14px;">{{ activity.name }}</span>
                                </label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Stretches Dropdown -->
                        <div>
                            <label style="display:block;margin-bottom:10px;font-weight:600;color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üõ£Ô∏è Map to Road Stretches <span style="color:#ef4444;">*</span></label>
                            <div onclick="toggleStretchDropdown()" style="width: 100%; padding: 14px 16px; border-radius: 12px; border: 2px solid rgba(148, 163, 184, 0.25); background: linear-gradient(135deg, rgba(30,41,59,0.7) 0%, rgba(30,41,59,0.5) 100%); color: #fff; font-size: 14px; font-weight: 500; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(148,163,184,0.5)'; this.style.boxShadow='0 0 12px rgba(148,163,184,0.15)'" onmouseout="this.style.borderColor='rgba(148,163,184,0.25)'; this.style.boxShadow='none'">
                                <span id="stretchDropdownLabel">Select stretches...</span>
                                <span id="stretchDropdownIcon" style="transition: transform 0.3s; font-size: 16px;">‚ñº</span>
                            </div>
                            <div id="stretchDropdownList" style="display: none; margin-top: 8px; border: 2px solid rgba(148, 163, 184, 0.25); border-radius: 12px; background: linear-gradient(135deg, rgba(30,41,59,0.8) 0%, rgba(30,41,59,0.6) 100%); max-height: 280px; overflow-y: auto; box-shadow: 0 4px 12px rgba(148, 163, 184, 0.15);">
                                {% for stretch in stretches %}
                                <label style="display: flex; align-items: center; padding: 12px 14px; cursor: pointer; border-bottom: 1px solid rgba(148, 163, 184, 0.12); transition: all 0.2s ease;" onmouseover="this.style.background='rgba(148, 163, 184, 0.08)'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" name="stretch_mapping" value="{{ stretch.id }}" style="margin-right: 10px; cursor: pointer; width: 18px; height: 18px; accent-color: #94a3b8;">
                                    <span style="color: #cbd5e1; font-size: 14px;">{{ stretch.stretch_name }} ({{ stretch.length_m }}m)</span>
                                </label>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
            </div>

            <!-- Inventory Settings (Collapsible) -->
            <div style="background: linear-gradient(135deg, rgba(148, 163, 184, 0.08) 0%, rgba(148, 163, 184, 0.03) 100%); border: 2px solid rgba(148, 163, 184, 0.2); border-left: 6px solid #94a3b8; border-radius: 12px; margin-bottom: 36px; overflow: hidden; position: relative; box-shadow: 0 2px 8px rgba(148, 163, 184, 0.06);">
                <div style="position: absolute; top: -40px; right: -40px; width: 150px; height: 150px; background: radial-gradient(circle, rgba(168, 85, 247, 0.1) 0%, transparent 70%); border-radius: 50%;"></div>
                <div onclick="toggleInventorySection()" style="padding: 28px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 1; border-bottom: 2px solid rgba(148, 163, 184, 0.15); transition: all 0.3s ease;" onmouseover="this.style.background='rgba(148, 163, 184, 0.05)'" onmouseout="this.style.background='transparent'">
                    <div style="display: flex; align-items: center; gap: 14px;">
                        <span style="font-size: 32px; background: linear-gradient(135deg, #64748b 0%, #475569 100%); padding: 8px 12px; border-radius: 10px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(148, 163, 184, 0.3);">üìä</span>
                        <h4 style="margin: 0; color: #e2e8f0; font-size: 20px; font-weight: 800; letter-spacing: 0.3px;">Inventory Settings</h4>
                        <span style="font-size: 12px; color: #e2e8f0; background: linear-gradient(135deg, rgba(148, 163, 184, 0.2) 0%, rgba(148, 163, 184, 0.1) 100%); padding: 6px 14px; border-radius: 20px; border: 1px solid rgba(148, 163, 184, 0.3); font-weight: 600;">3Ô∏è‚É£ Optional</span>
                    </div>
                    <span id="inventoryToggleIcon" style="color: #94a3b8; font-size: 20px; transition: transform 0.3s; padding: 10px 12px; background: linear-gradient(135deg, rgba(148, 163, 184, 0.2) 0%, rgba(148, 163, 184, 0.1) 100%); border-radius: 8px; border: 1px solid rgba(148, 163, 184, 0.2);">‚ñº</span>
                </div>
                <div id="inventorySection" style="display: none; padding: 0 28px 28px 28px; position: relative; z-index: 1;">
                    <p style="color: #cbd5e1; font-size: 13px; margin: 20px 0; padding: 14px 16px; background: linear-gradient(135deg, rgba(148, 163, 184, 0.1) 0%, rgba(148, 163, 184, 0.05) 100%); border-left: 4px solid #94a3b8; border-radius: 8px; line-height: 1.6; font-weight: 500;">üí° <strong style="color: #94a3b8;">Pro Tip:</strong> Initialize inventory tracking with opening stock and set alert thresholds. These settings are optional and can be configured later.</p>
                    <div class="form-grid" style="display:grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                        <div>
                            <label for="modal_opening_stock" style="display:block;margin-bottom:10px;font-weight:600;color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üì¶ Opening Stock</label>
                            <input type="number" id="modal_opening_stock" name="opening_stock" placeholder="0" min="0" step="0.01" style="width: 100%; padding: 14px 16px; border-radius: 12px; border: 2px solid rgba(148, 163, 184, 0.25); background: linear-gradient(135deg, rgba(30,41,59,0.7) 0%, rgba(30,41,59,0.5) 100%); color: #fff; font-size: 14px; font-weight: 500; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(148,163,184,0.6)'; this.style.boxShadow='0 0 16px rgba(148,163,184,0.2); inset 0 1px 3px rgba(148,163,184,0.1)'" onblur="this.style.borderColor='rgba(148,163,184,0.25)'; this.style.boxShadow='none'">
                            <small style="color: #94a3b8; font-size: 12px; margin-top: 6px; display: block;">Initial quantity in inventory</small>
                        </div>
                        <div>
                            <label for="modal_stock_location" style="display:block;margin-bottom:10px;font-weight:600;color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üìç Storage Location</label>
                            <select name="stock_location" id="modal_stock_location" style="width: 100%; padding: 14px 16px; border-radius: 12px; border: 2px solid rgba(148, 163, 184, 0.25); background: linear-gradient(135deg, rgba(30,41,59,0.7) 0%, rgba(30,41,59,0.5) 100%); color: #fff; font-size: 14px; font-weight: 500; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(148,163,184,0.6)'; this.style.boxShadow='0 0 16px rgba(148,163,184,0.2); inset 0 1px 3px rgba(148,163,184,0.1)'" onblur="this.style.borderColor='rgba(148,163,184,0.25)'; this.style.boxShadow='none'">
                                <option value="">Select Location</option>
                                <option value="Site">Site</option>
                                <option value="Store">Store/Yard</option>
                                <option value="Warehouse">Warehouse</option>
                            </select>
                        </div>
                        <div>
                            <label for="modal_stock_date" style="display:block;margin-bottom:10px;font-weight:600;color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üìÖ Stock Date</label>
                            <input type="date" id="modal_stock_date" name="stock_date" style="width: 100%; padding: 14px 16px; border-radius: 12px; border: 2px solid rgba(148, 163, 184, 0.25); background: linear-gradient(135deg, rgba(30,41,59,0.7) 0%, rgba(30,41,59,0.5) 100%); color: #fff; font-size: 14px; font-weight: 500; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(148,163,184,0.6)'; this.style.boxShadow='0 0 16px rgba(148,163,184,0.2); inset 0 1px 3px rgba(148,163,184,0.1)'" onblur="this.style.borderColor='rgba(148,163,184,0.25)'; this.style.boxShadow='none'">
                            <small style="color: #94a3b8; font-size: 12px; margin-top: 6px; display: block;">Defaults to today</small>
                        </div>
                        <div>
                            <label for="modal_min_stock" style="display:block;margin-bottom:10px;font-weight:600;color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">‚ö†Ô∏è Minimum Stock Level</label>
                            <input type="number" id="modal_min_stock" name="minimum_stock" placeholder="0" min="0" step="0.01" style="width: 100%; padding: 14px 16px; border-radius: 12px; border: 2px solid rgba(148, 163, 184, 0.25); background: linear-gradient(135deg, rgba(30,41,59,0.7) 0%, rgba(30,41,59,0.5) 100%); color: #fff; font-size: 14px; font-weight: 500; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(148,163,184,0.6)'; this.style.boxShadow='0 0 16px rgba(148,163,184,0.2); inset 0 1px 3px rgba(148,163,184,0.1)'" onblur="this.style.borderColor='rgba(148,163,184,0.25)'; this.style.boxShadow='none'">
                            <small style="color: #94a3b8; font-size: 12px; margin-top: 6px; display: block;">Triggers low-stock alerts when breached</small>
                        </div>
                        <div>
                            <label style="display:block;margin-bottom:10px;font-weight:600;color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üîî Low Stock Alert</label>
                            <div style="display: flex; align-items: center; gap: 12px; padding: 8px 0;">
                                <label class="toggle-switch" style="position: relative; display: inline-block; width: 50px; height: 26px;">
                                    <input type="checkbox" id="modal_low_stock_alert" name="low_stock_alert" style="opacity: 0; width: 0; height: 0;">
                                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #475569; transition: 0.3s ease; border-radius: 26px; display: block; border: 2px solid rgba(148, 163, 184, 0.2);"></span>
                                    <span style="position: absolute; content: ''; height: 18px; width: 18px; left: 4px; bottom: 2px; background: white; transition: 0.3s ease; border-radius: 50%; display: block;"></span>
                                </label>
                                <span style="color: #cbd5e1; font-size: 13px; font-weight: 500;">Enable notifications</span>
                            </div>
                            <small style="color: #94a3b8; font-size: 12px; display: block;">Get alerts when stock falls below minimum</small>
                        </div>
                        <div>
                            <label for="modal_wastage_percentage" style="display:block;margin-bottom:10px;font-weight:600;color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üìä Expected Wastage %</label>
                            <input type="number" id="modal_wastage_percentage" name="wastage_percentage" placeholder="0" min="0" max="100" step="0.1" style="width: 100%; padding: 14px 16px; border-radius: 12px; border: 2px solid rgba(148, 163, 184, 0.25); background: linear-gradient(135deg, rgba(30,41,59,0.7) 0%, rgba(30,41,59,0.5) 100%); color: #fff; font-size: 14px; font-weight: 500; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(148,163,184,0.6)'; this.style.boxShadow='0 0 16px rgba(148,163,184,0.2); inset 0 1px 3px rgba(148,163,184,0.1)'" onblur="this.style.borderColor='rgba(148,163,184,0.25)'; this.style.boxShadow='none'">
                            <small style="color: #94a3b8; font-size: 12px; margin-top: 6px; display: block;">Typical: 2-5% for aggregates</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Info Note -->
            <div style="background: linear-gradient(135deg, rgba(148, 163, 184, 0.1) 0%, rgba(148, 163, 184, 0.05) 100%); border: 2px solid rgba(148, 163, 184, 0.25); border-left: 6px solid #94a3b8; border-radius: 12px; padding: 18px 20px; margin-bottom: 28px; display: flex; gap: 14px; align-items: flex-start; box-shadow: 0 2px 8px rgba(148, 163, 184, 0.06);">
                <span style="font-size: 24px; flex-shrink: 0; background: linear-gradient(135deg, #64748b 0%, #475569 100%); padding: 6px 10px; border-radius: 8px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(148, 163, 184, 0.2);">üí°</span>
                <div style="flex: 1;">
                    <p style="margin: 0; color: #cbd5e1; font-size: 13px; line-height: 1.7;">
                        <strong style="color: #e2e8f0; font-weight: 800;">‚úì Pro Tips:</strong>
                        <br>‚úì Material pricing & vendor rates are managed separately in the vendor section
                        <br>‚úì Opening stock is optional and used only to initialize inventory tracking
                        <br>‚úì You can map materials to activities and stretches anytime after creation
                    </p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div style="display:flex;gap:12px;justify-content:flex-end;position:sticky;bottom:0;margin:40px -40px -40px -40px;padding:24px 40px;background:linear-gradient(180deg,transparent 0%,rgba(255, 255, 255, 0.95) 60%,rgba(255, 255, 255, 0.98) 100%);border-top:2px solid var(--border-color); box-shadow: 0 -4px 12px rgba(0,0,0,0.05);">
                <button type="button" onclick="closeAddMaterialModal()" style="background: rgba(100, 116, 139, 0.1); border: 1.5px solid rgba(100, 116, 139, 0.2); border-radius: 8px; padding: 10px 24px; color: var(--text-primary); font-weight: 600; cursor: pointer; font-size: 14px; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px;" onmouseover="this.style.background='rgba(100, 116, 139, 0.15)'; this.style.borderColor='rgba(100, 116, 139, 0.3)'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(100, 116, 139, 0.15)'" onmouseout="this.style.background='rgba(100, 116, 139, 0.1)'; this.style.borderColor='rgba(100, 116, 139, 0.2)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    ‚úï Cancel
                </button>
                <button type="submit" style="background: linear-gradient(135deg, #4f8cff 0%, #3a6fd8 100%); border: none; border-radius: 8px; padding: 10px 24px; color: #fff; font-weight: 600; cursor: pointer; font-size: 14px; box-shadow: 0 4px 15px rgba(79, 140, 255, 0.4), 0 0 20px rgba(79, 140, 255, 0.15); transition: all 0.3s ease; display: flex; align-items: center; gap: 6px;" onmouseover="this.style.boxShadow='0 6px 25px rgba(79, 140, 255, 0.5), 0 0 30px rgba(79, 140, 255, 0.25)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='0 4px 15px rgba(79, 140, 255, 0.4), 0 0 20px rgba(79, 140, 255, 0.15)'; this.style.transform='translateY(0)'">
                    <span>‚úì</span> Add Material
                </button>
            </div>
        </form>
    </div>
</div>

<style>
    /* Toggle switch styling */
    .toggle-switch input:checked + span {
        background: linear-gradient(135deg, #64748b 0%, #475569 100%) !important;
        border-color: rgba(148, 163, 184, 0.4) !important;
    }
    .toggle-switch input:checked + span + span {
        transform: translateX(24px);
    }
    .toggle-switch span:first-of-type {
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
    }
</style>

<script>
    // Set today's date as default for stock date
    document.addEventListener('DOMContentLoaded', function() {
        const stockDateInput = document.getElementById('modal_stock_date');
        if (stockDateInput) {
            const today = new Date().toISOString().split('T')[0];
            stockDateInput.value = today;
        }
    });

    // Toggle inventory section
    function toggleInventorySection() {
        const section = document.getElementById('inventorySection');
        const icon = document.getElementById('inventoryToggleIcon');
        if (section.style.display === 'none') {
            section.style.display = 'block';
            icon.style.transform = 'rotate(180deg)';
        } else {
            section.style.display = 'none';
            icon.style.transform = 'rotate(0deg)';
        }
    }

    // Toggle activity dropdown
    function toggleActivityDropdown() {
        const dropdown = document.getElementById('activityDropdownList');
        const icon = document.getElementById('activityDropdownIcon');
        if (dropdown.style.display === 'none') {
            dropdown.style.display = 'block';
            icon.style.transform = 'rotate(180deg)';
        } else {
            dropdown.style.display = 'none';
            icon.style.transform = 'rotate(0deg)';
        }
    }

    // Toggle stretch dropdown
    function toggleStretchDropdown() {
        const dropdown = document.getElementById('stretchDropdownList');
        const icon = document.getElementById('stretchDropdownIcon');
        if (dropdown.style.display === 'none') {
            dropdown.style.display = 'block';
            icon.style.transform = 'rotate(180deg)';
        } else {
            dropdown.style.display = 'none';
            icon.style.transform = 'rotate(0deg)';
        }
    }

    // Update activity label when checkboxes change
    document.addEventListener('change', function(e) {
        if (e.target.name === 'activity_mapping') {
            updateActivityLabel();
        }
        if (e.target.name === 'stretch_mapping') {
            updateStretchLabel();
        }
    });

    function updateActivityLabel() {
        const checkboxes = document.querySelectorAll('input[name="activity_mapping"]:checked');
        const label = document.getElementById('activityDropdownLabel');
        if (checkboxes.length === 0) {
            label.textContent = 'Select activities...';
        } else if (checkboxes.length === 1) {
            label.textContent = checkboxes[0].nextElementSibling.textContent;
        } else {
            label.textContent = checkboxes.length + ' activities selected';
        }
    }

    function updateStretchLabel() {
        const checkboxes = document.querySelectorAll('input[name="stretch_mapping"]:checked');
        const label = document.getElementById('stretchDropdownLabel');
        if (checkboxes.length === 0) {
            label.textContent = 'Select stretches...';
        } else if (checkboxes.length === 1) {
            label.textContent = checkboxes[0].nextElementSibling.textContent;
        } else {
            label.textContent = checkboxes.length + ' stretches selected';
        }
    }

    // Show/hide custom category input
    function toggleCustomCategoryInput() {
        const categorySelect = document.getElementById('modal_material_category');
        const customDiv = document.getElementById('customCategoryDiv');
        if (categorySelect && customDiv) {
            if (categorySelect.value === 'Other') {
                customDiv.style.display = 'block';
            } else {
                customDiv.style.display = 'none';
            }
        }
    }

    // Auto-generate material code based on category and name
    document.getElementById('modal_material_name')?.addEventListener('input', generateMaterialCode);
    document.getElementById('modal_material_category')?.addEventListener('change', generateMaterialCode);

    function generateMaterialCode() {
        const name = document.getElementById('modal_material_name')?.value || '';
        const category = document.getElementById('modal_material_category')?.value || '';
        const codeInput = document.getElementById('modal_material_code');
        
        if (name && category && codeInput) {
            const prefix = category.substring(0, 3).toUpperCase();
            const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            codeInput.value = `${prefix}-${randomNum}`;
        }
    }
</script>

<!-- Add Vendor Modal -->
<div id="addVendorModal" class="modal">
    <div class="modal-content" style="max-width: 95vw; width: 90vw; max-height: 90vh; overflow-y: auto; margin: 0 auto; padding: 0; border-radius: 12px; background: white;">
        <div style="position: sticky; top: 0; z-index: 10; padding: 28px 40px; margin: 0; background: linear-gradient(135deg, rgba(79, 140, 255, 0.08) 0%, rgba(79, 140, 255, 0.03) 100%); border-bottom: 2px solid rgba(79, 140, 255, 0.15); border-radius: 0; display: flex; align-items: center; justify-content: space-between; gap: 16px;">
            <div style="display: flex; align-items: center; gap: 14px;">
                <span style="font-size: 40px; display: flex; align-items: center; justify-content: center; width: 60px; height: 60px; background: linear-gradient(135deg, rgba(79, 140, 255, 0.15) 0%, rgba(79, 140, 255, 0.08) 100%); border-radius: 12px; border: 2px solid rgba(79, 140, 255, 0.2);">üè¢</span>
                <div>
                    <h3 style="margin: 0; color: var(--text-primary); font-size: 24px; font-weight: 700;">Add New Vendor</h3>
                    <p style="color: var(--text-secondary); font-size: 13px; margin: 4px 0 0 0; line-height: 1.4;">Register suppliers, define rates, lead times, and commercial terms</p>
                </div>
            </div>
            <span class="close" onclick="closeAddVendorModal()" style="cursor: pointer; color: #ef4444; font-size: 24px; transition: all 0.3s ease; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 8px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); flex-shrink: 0;" onmouseover="this.style.background='rgba(239, 68, 68, 0.2)'; this.style.borderColor='rgba(239, 68, 68, 0.5)'; this.style.transform='rotate(90deg)'" onmouseout="this.style.background='rgba(239, 68, 68, 0.1)'; this.style.borderColor='rgba(239, 68, 68, 0.3)'; this.style.transform='rotate(0deg)'">&times;</span>
        </div>
        
        <div style="padding: 40px;">
        <form method="post" action="/vendors/add" id="addVendorForm">
            <!-- Step Indicator -->
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 48px; padding: 18px; background: linear-gradient(135deg, rgba(79, 140, 255, 0.06) 0%, rgba(79, 140, 255, 0.02) 100%); border: 1px solid rgba(79, 140, 255, 0.12); border-radius: 14px;">
                <div style="text-align: center; padding: 14px; background: linear-gradient(135deg, rgba(79, 140, 255, 0.25) 0%, rgba(79, 140, 255, 0.15) 100%); border-radius: 12px; border: 2px solid rgba(79, 140, 255, 0.4); box-shadow: 0 4px 12px rgba(79, 140, 255, 0.15); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(79, 140, 255, 0.25)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(79, 140, 255, 0.15)'">
                    <span style="color: #fff; font-weight: 700; font-size: 13px; background: linear-gradient(135deg, #4f8cff 0%, #3a6fd8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">1Ô∏è‚É£ Basic Info</span>
                </div>
                <div style="text-align: center; padding: 14px; background: rgba(79, 140, 255, 0.05); border-radius: 12px; border: 1.5px solid rgba(79, 140, 255, 0.15); transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(79, 140, 255, 0.3)'; this.style.background='rgba(79, 140, 255, 0.08)'" onmouseout="this.style.borderColor='rgba(79, 140, 255, 0.15)'; this.style.background='rgba(79, 140, 255, 0.05)'">
                    <span style="color: #94a3b8; font-weight: 600; font-size: 13px;">2Ô∏è‚É£ Commercial</span>
                </div>
                <div style="text-align: center; padding: 14px; background: rgba(79, 140, 255, 0.05); border-radius: 12px; border: 1.5px solid rgba(79, 140, 255, 0.15); transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(79, 140, 255, 0.3)'; this.style.background='rgba(79, 140, 255, 0.08)'" onmouseout="this.style.borderColor='rgba(79, 140, 255, 0.15)'; this.style.background='rgba(79, 140, 255, 0.05)'">
                    <span style="color: #94a3b8; font-weight: 600; font-size: 13px;">3Ô∏è‚É£ Materials</span>
                </div>
                <div style="text-align: center; padding: 14px; background: rgba(79, 140, 255, 0.05); border-radius: 12px; border: 1.5px solid rgba(79, 140, 255, 0.15); transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(79, 140, 255, 0.3)'; this.style.background='rgba(79, 140, 255, 0.08)'" onmouseout="this.style.borderColor='rgba(79, 140, 255, 0.15)'; this.style.background='rgba(79, 140, 255, 0.05)'">
                    <span style="color: #94a3b8; font-weight: 600; font-size: 13px;">4Ô∏è‚É£ Documents</span>
                </div>
            </div>

            <!-- Basic Information Section -->
            <div style="background: linear-gradient(135deg, rgba(79, 140, 255, 0.08) 0%, rgba(79, 140, 255, 0.02) 100%); border: 2px solid rgba(79, 140, 255, 0.18); border-left: 6px solid #4f8cff; padding: 28px; border-radius: 16px; margin-bottom: 36px; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(79, 140, 255, 0.06);" onmouseover="this.style.borderColor='rgba(79, 140, 255, 0.28)'; this.style.boxShadow='0 8px 28px rgba(79, 140, 255, 0.12)'" onmouseout="this.style.borderColor='rgba(79, 140, 255, 0.18)'; this.style.boxShadow='0 2px 8px rgba(79, 140, 255, 0.06)'">
                <h4 style="margin: 0 0 28px 0; color: #4f8cff; font-size: 20px; font-weight: 800; display: flex; align-items: center; gap: 14px; letter-spacing: 0.3px;">
                    <span style="background: linear-gradient(135deg, #4f8cff 0%, #3a6fd8 100%); color: #fff; width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; box-shadow: 0 4px 12px rgba(79, 140, 255, 0.3);">üìã</span>
                    Basic Information
                </h4>
                <div class="form-grid" style="display:grid; grid-template-columns: repeat(4, 1fr); gap: 24px;">
                    <div>
                        <label for="vendor_name" style="display:block;margin-bottom:10px;font-weight:800;color:#e2e8f0;font-size:12px;text-transform:uppercase;letter-spacing:0.8px;">üè∑Ô∏è Vendor Name <span style="color:#ff6b6b;">*</span></label>
                        <input type="text" id="vendor_name" name="vendor_name" placeholder="e.g., ABC Cement Suppliers" required style="width: 100%; padding: 14px 16px; border-radius: 12px; border: 2px solid rgba(79, 140, 255, 0.22); background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(30, 41, 59, 0.5) 100%); color: #cbd5e1; font-size: 14px; font-weight: 500; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.6)'; this.style.background='linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(30, 41, 59, 0.7) 100%)'; this.style.boxShadow='0 0 16px rgba(79, 140, 255, 0.25), inset 0 1px 2px rgba(255, 255, 255, 0.05)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(79, 140, 255, 0.22)'; this.style.background='linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(30, 41, 59, 0.5) 100%)'; this.style.boxShadow='none'">
                    </div>
                    <div>
                        <label for="vendor_type" style="display:block;margin-bottom:8px;font-weight:700;color:#cbd5e1;font-size:13px;text-transform:uppercase;letter-spacing:0.5px;">Vendor Type <span style="color:#ef4444;">*</span></label>
                        <select name="vendor_type" id="vendor_type" required style="width: 100%; padding: 12px 14px; border-radius: 10px; border: 2px solid rgba(79, 140, 255, 0.2); background: rgba(30, 41, 59, 0.6); color: #cbd5e1; font-size: 14px; transition: all 0.3s ease; cursor: pointer;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.5)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'" onblur="this.style.borderColor='rgba(79, 140, 255, 0.2)'; this.style.background='rgba(30, 41, 59, 0.6)'; this.style.boxShadow='none'">
                            <option value="">Select Type</option>
                            <option value="Manufacturer">Manufacturer</option>
                            <option value="Distributor">Distributor</option>
                            <option value="Local Supplier">Local Supplier</option>
                            <option value="Transporter">Transporter</option>
                        </select>
                    </div>
                    <div>
                        <label for="vendor_contact" style="display:block;margin-bottom:8px;font-weight:700;color:#cbd5e1;font-size:13px;text-transform:uppercase;letter-spacing:0.5px;">Contact Number <span style="color:#ef4444;">*</span></label>
                        <input type="tel" id="vendor_contact" name="vendor_contact" placeholder="+91 98765 43210" required style="width: 100%; padding: 12px 14px; border-radius: 10px; border: 2px solid rgba(79, 140, 255, 0.2); background: rgba(30, 41, 59, 0.6); color: #cbd5e1; font-size: 14px; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.5)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(79, 140, 255, 0.2)'; this.style.background='rgba(30, 41, 59, 0.6)'; this.style.boxShadow='none'">
                    </div>
                    <div>
                        <label for="vendor_email" style="display:block;margin-bottom:8px;font-weight:700;color:#cbd5e1;font-size:13px;text-transform:uppercase;letter-spacing:0.5px;">Email Address</label>
                        <input type="email" id="vendor_email" name="vendor_email" placeholder="vendor@example.com" style="width: 100%; padding: 12px 14px; border-radius: 10px; border: 2px solid rgba(79, 140, 255, 0.2); background: rgba(30, 41, 59, 0.6); color: #cbd5e1; font-size: 14px; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.5)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(79, 140, 255, 0.2)'; this.style.background='rgba(30, 41, 59, 0.6)'; this.style.boxShadow='none'">
                    </div>
                    <div>
                        <label for="vendor_location" style="display:block;margin-bottom:8px;font-weight:700;color:#cbd5e1;font-size:13px;text-transform:uppercase;letter-spacing:0.5px;">Location <span style="color:#ef4444;">*</span></label>
                        <input type="text" id="vendor_location" name="vendor_location" placeholder="City, State" required style="width: 100%; padding: 12px 14px; border-radius: 10px; border: 2px solid rgba(79, 140, 255, 0.2); background: rgba(30, 41, 59, 0.6); color: #cbd5e1; font-size: 14px; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.5)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(79, 140, 255, 0.2)'; this.style.background='rgba(30, 41, 59, 0.6)'; this.style.boxShadow='none'">
                    </div>
                    <div>
                        <label for="service_area" style="display:block;margin-bottom:8px;font-weight:700;color:#cbd5e1;font-size:13px;text-transform:uppercase;letter-spacing:0.5px;">Service Area / Reach</label>
                        <input type="text" id="service_area" name="service_area" placeholder="e.g., 50 km radius, City-wide" style="width: 100%; padding: 12px 14px; border-radius: 10px; border: 2px solid rgba(79, 140, 255, 0.2); background: rgba(30, 41, 59, 0.6); color: #cbd5e1; font-size: 14px; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.5)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(79, 140, 255, 0.2)'; this.style.background='rgba(30, 41, 59, 0.6)'; this.style.boxShadow='none'">
                    </div>
                    <div>
                        <label for="vendor_priority" style="display:block;margin-bottom:8px;font-weight:700;color:#cbd5e1;font-size:13px;text-transform:uppercase;letter-spacing:0.5px;">Priority Level</label>
                        <select id="vendor_priority" name="vendor_priority" style="width: 100%; padding: 12px 14px; border-radius: 10px; border: 2px solid rgba(79, 140, 255, 0.2); background: rgba(30, 41, 59, 0.6); color: #cbd5e1; font-size: 14px; transition: all 0.3s ease; cursor: pointer;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.5)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'" onblur="this.style.borderColor='rgba(79, 140, 255, 0.2)'; this.style.background='rgba(30, 41, 59, 0.6)'; this.style.boxShadow='none'">
                            <option value="Primary">üî¥ Primary</option>
                            <option value="Secondary">üü° Secondary</option>
                            <option value="Backup">üü¢ Backup</option>
                        </select>
                        <small style="color: #94a3b8; font-size: 11px; display: block; margin-top: 4px;">Used for purchase suggestions</small>
                    </div>
                    <div>
                        <label for="reliability_rating" style="display:block;margin-bottom:8px;font-weight:700;color:#cbd5e1;font-size:13px;text-transform:uppercase;letter-spacing:0.5px;">Reliability Rating</label>
                        <select id="reliability_rating" name="reliability_rating" style="width: 100%; padding: 12px 14px; border-radius: 10px; border: 2px solid rgba(79, 140, 255, 0.2); background: rgba(30, 41, 59, 0.6); color: #cbd5e1; font-size: 14px; transition: all 0.3s ease; cursor: pointer;" onfocus="this.style.borderColor='rgba(79, 140, 255, 0.5)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='0 0 12px rgba(79, 140, 255, 0.2)'" onblur="this.style.borderColor='rgba(79, 140, 255, 0.2)'; this.style.background='rgba(30, 41, 59, 0.6)'; this.style.boxShadow='none'">
                            <option value="High">‚≠ê‚≠ê‚≠ê High</option>
                            <option value="Medium" selected>‚≠ê‚≠ê Medium</option>
                            <option value="Low">‚≠ê Low</option>
                        </select>
                        <small style="color: #94a3b8; font-size: 11px; display: block; margin-top: 4px;">Internal rating for tracking</small>
                    </div>
                </div>
            </div>

            <!-- Commercial Details Section -->
            <div style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.08) 0%, rgba(34, 197, 94, 0.02) 100%); border: 2px solid rgba(34, 197, 94, 0.18); border-left: 6px solid #22c55e; padding: 28px; border-radius: 16px; margin-bottom: 36px; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(34, 197, 94, 0.06);" onmouseover="this.style.borderColor='rgba(34, 197, 94, 0.28)'; this.style.boxShadow='0 8px 28px rgba(34, 197, 94, 0.12)'" onmouseout="this.style.borderColor='rgba(34, 197, 94, 0.18)'; this.style.boxShadow='0 2px 8px rgba(34, 197, 94, 0.06)'">
                <h4 style="margin: 0 0 28px 0; color: #22c55e; font-size: 20px; font-weight: 800; display: flex; align-items: center; gap: 14px; letter-spacing: 0.3px;">
                    <span style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: #fff; width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);">üí∞</span>
                    Commercial Details
                </h4>
                <div class="form-grid" style="display:grid; grid-template-columns: repeat(4, 1fr); gap: 24px;">
                    <div>
                        <label for="payment_terms" style="display:block;margin-bottom:8px;font-weight:700;color:#cbd5e1;font-size:13px;text-transform:uppercase;letter-spacing:0.5px;">Payment Terms <span style="color:#ef4444;">*</span></label>
                        <select name="payment_terms" id="payment_terms" required onchange="toggleCreditPeriod()" style="width: 100%; padding: 12px 14px; border-radius: 10px; border: 2px solid rgba(34, 197, 94, 0.2); background: rgba(30, 41, 59, 0.6); color: #cbd5e1; font-size: 14px; transition: all 0.3s ease; cursor: pointer;" onfocus="this.style.borderColor='rgba(34, 197, 94, 0.5)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='0 0 12px rgba(34, 197, 94, 0.2)'" onblur="this.style.borderColor='rgba(34, 197, 94, 0.2)'; this.style.background='rgba(30, 41, 59, 0.6)'; this.style.boxShadow='none'">
                            <option value="">Select Payment Terms</option>
                            <option value="Advance">üí≥ Advance</option>
                            <option value="COD">üè™ COD (Cash on Delivery)</option>
                            <option value="Credit">üìã Credit</option>
                        </select>
                    </div>
                    <div id="creditPeriodDiv" style="display:none;">
                        <label for="credit_period" style="display:block;margin-bottom:8px;font-weight:700;color:#cbd5e1;font-size:13px;text-transform:uppercase;letter-spacing:0.5px;">Credit Period (Days)</label>
                        <input type="number" id="credit_period" name="credit_period" placeholder="e.g., 30, 45, 60" min="0" style="width: 100%; padding: 12px 14px; border-radius: 10px; border: 2px solid rgba(34, 197, 94, 0.2); background: rgba(30, 41, 59, 0.6); color: #cbd5e1; font-size: 14px; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(34, 197, 94, 0.5)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='0 0 12px rgba(34, 197, 94, 0.2)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(34, 197, 94, 0.2)'; this.style.background='rgba(30, 41, 59, 0.6)'; this.style.boxShadow='none'">
                        <small style="color: #94a3b8; font-size: 11px; display: block; margin-top: 4px;">Days allowed for payment</small>
                    </div>
                    <div>
                        <label for="gst_number" style="display:block;margin-bottom:8px;font-weight:700;color:#cbd5e1;font-size:13px;text-transform:uppercase;letter-spacing:0.5px;">GST Number</label>
                        <input type="text" id="gst_number" name="gst_number" placeholder="22AAAAA0000A1Z5" style="width: 100%; padding: 12px 14px; border-radius: 10px; border: 2px solid rgba(34, 197, 94, 0.2); background: rgba(30, 41, 59, 0.6); color: #cbd5e1; font-size: 14px; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(34, 197, 94, 0.5)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='0 0 12px rgba(34, 197, 94, 0.2)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(34, 197, 94, 0.2)'; this.style.background='rgba(30, 41, 59, 0.6)'; this.style.boxShadow='none'">
                    </div>
                    <div>
                        <label for="gst_percentage" style="display:block;margin-bottom:8px;font-weight:700;color:#cbd5e1;font-size:13px;text-transform:uppercase;letter-spacing:0.5px;">GST Percentage (%)</label>
                        <input type="number" id="gst_percentage" name="gst_percentage" placeholder="18" min="0" max="100" step="0.1" style="width: 100%; padding: 12px 14px; border-radius: 10px; border: 2px solid rgba(34, 197, 94, 0.2); background: rgba(30, 41, 59, 0.6); color: #cbd5e1; font-size: 14px; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(34, 197, 94, 0.5)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='0 0 12px rgba(34, 197, 94, 0.2)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(34, 197, 94, 0.2)'; this.style.background='rgba(30, 41, 59, 0.6)'; this.style.boxShadow='none'">
                    </div>
                </div>
            </div>

            <!-- Materials Supplied Section (Repeatable) -->
            <div style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.08) 0%, rgba(168, 85, 247, 0.02) 100%); border: 2px solid rgba(168, 85, 247, 0.18); border-left: 6px solid #a855f7; padding: 28px; border-radius: 16px; margin-bottom: 36px; box-shadow: 0 2px 8px rgba(168, 85, 247, 0.06);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 28px;">
                    <h4 style="margin: 0; color: #a855f7; font-size: 20px; font-weight: 800; display: flex; align-items: center; gap: 14px; letter-spacing: 0.3px;">
                        <span style="background: linear-gradient(135deg, #a855f7 0%, #7e22ce 100%); color: #fff; width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);">üì¶</span>
                        Materials Supplied
                    </h4>
                    <button type="button" onclick="addMaterialRow()" style="background: linear-gradient(135deg, #a855f7 0%, #7e22ce 100%); border: none; border-radius: 10px; padding: 12px 24px; color: #fff; font-weight: 700; cursor: pointer; font-size: 14px; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(168, 85, 247, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(168, 85, 247, 0.3)'">+ Add Material</button>
                </div>
                <div id="materialsSuppliedContainer">
                    <!-- Material Row 1 (Default) -->
                    <div class="material-row" style="background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(30, 41, 59, 0.4) 100%); border: 2px solid rgba(168, 85, 247, 0.2); border-radius: 14px; padding: 20px; margin-bottom: 18px; position: relative; transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(168, 85, 247, 0.35)'; this.style.boxShadow='0 4px 12px rgba(168, 85, 247, 0.15)'" onmouseout="this.style.borderColor='rgba(168, 85, 247, 0.2)'; this.style.boxShadow='none'">
                        <button type="button" onclick="removeMaterialRow(this)" style="position: absolute; top: 14px; right: 14px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border: none; border-radius: 8px; padding: 8px 14px; color: #fff; font-weight: 700; cursor: pointer; font-size: 12px; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(239, 68, 68, 0.3)'">‚úï Remove</button>
                        <div class="form-grid" style="display:grid; grid-template-columns: 2.5fr 1.2fr 1.2fr 1.2fr 1.2fr; gap: 16px; margin-bottom: 14px;">
                            <div>
                                <label style="display:block;margin-bottom:7px;font-weight:700;color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:0.5px;">Material <span style="color:#ef4444;">*</span></label>
                                <select name="materials_supplied[]" required style="width: 100%; padding: 10px 12px; border-radius: 10px; border: 2px solid rgba(168, 85, 247, 0.2); background: rgba(30, 41, 59, 0.8); color: #cbd5e1; font-size: 13px; transition: all 0.3s ease; cursor: pointer;" onfocus="this.style.borderColor='rgba(168, 85, 247, 0.5)'; this.style.boxShadow='0 0 10px rgba(168, 85, 247, 0.2)'" onblur="this.style.borderColor='rgba(168, 85, 247, 0.2)'; this.style.boxShadow='none'">
                                    <option value="">Select Material</option>
                                    {% for material in materials %}
                                    <option value="{{ material.id }}">{{ material.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label style="display:block;margin-bottom:7px;font-weight:700;color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:0.5px;">Unit Price <span style="color:#ef4444;">*</span></label>
                                <input type="number" name="unit_prices[]" placeholder="‚Çπ 380" min="0" step="0.01" required style="width: 100%; padding: 10px 12px; border-radius: 10px; border: 2px solid rgba(168, 85, 247, 0.2); background: rgba(30, 41, 59, 0.8); color: #cbd5e1; font-size: 13px; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(168, 85, 247, 0.5)'; this.style.background='rgba(30, 41, 59, 0.95)'; this.style.boxShadow='0 0 10px rgba(168, 85, 247, 0.2)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(168, 85, 247, 0.2)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='none'">
                            </div>
                            <div>
                                <label style="display:block;margin-bottom:7px;font-weight:700;color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:0.5px;">Per Unit Qty <span style="color:#ef4444;">*</span></label>
                                <input type="number" name="per_unit_quantities[]" placeholder="50" min="0" step="0.01" required style="width: 100%; padding: 10px 12px; border-radius: 10px; border: 2px solid rgba(168, 85, 247, 0.2); background: rgba(30, 41, 59, 0.8); color: #cbd5e1; font-size: 13px; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(168, 85, 247, 0.5)'; this.style.background='rgba(30, 41, 59, 0.95)'; this.style.boxShadow='0 0 10px rgba(168, 85, 247, 0.2)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(168, 85, 247, 0.2)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='none'">
                            </div>
                            <div>
                                <label style="display:block;margin-bottom:7px;font-weight:700;color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:0.5px;">Lead Time (days)</label>
                                <input type="number" name="lead_times[]" placeholder="7" min="0" style="width: 100%; padding: 10px 12px; border-radius: 10px; border: 2px solid rgba(168, 85, 247, 0.2); background: rgba(30, 41, 59, 0.8); color: #cbd5e1; font-size: 13px; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(168, 85, 247, 0.5)'; this.style.background='rgba(30, 41, 59, 0.95)'; this.style.boxShadow='0 0 10px rgba(168, 85, 247, 0.2)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(168, 85, 247, 0.2)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='none'">
                            </div>
                            <div>
                                <label style="display:block;margin-bottom:7px;font-weight:700;color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:0.5px;">Supply Capacity</label>
                                <input type="number" name="supply_capacities[]" placeholder="1000" min="0" style="width: 100%; padding: 10px 12px; border-radius: 10px; border: 2px solid rgba(168, 85, 247, 0.2); background: rgba(30, 41, 59, 0.8); color: #cbd5e1; font-size: 13px; transition: all 0.3s ease;" onfocus="this.style.borderColor='rgba(168, 85, 247, 0.5)'; this.style.background='rgba(30, 41, 59, 0.95)'; this.style.boxShadow='0 0 10px rgba(168, 85, 247, 0.2)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(168, 85, 247, 0.2)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='none'">
                            </div>
                        </div>
                        <small style="color: #a895ff; font-size: 11px; display: block; background: rgba(168, 85, 247, 0.1); padding: 8px 12px; border-radius: 8px; border-left: 3px solid #a855f7;">üìå Example: ‚Çπ380 per 50 kg bag, 7 days lead time, 1000 bags/month capacity</small>
                    </div>
                </div>
            </div>

            <!-- Contract Details (Collapsible) -->
            <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.08) 0%, rgba(245, 158, 11, 0.02) 100%); border: 2px solid rgba(245, 158, 11, 0.18); border-left: 6px solid #f59e0b; border-radius: 16px; margin-bottom: 36px; overflow: hidden; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.06);">
                <div onclick="toggleContractSection()" style="padding: 24px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease; user-select: none;" onmouseover="this.style.background='rgba(245, 158, 11, 0.06)'" onmouseout="this.style.background='transparent'">
                    <h4 style="margin: 0; color: #f59e0b; font-size: 20px; font-weight: 800; display: flex; align-items: center; gap: 14px; letter-spacing: 0.3px;">
                        <span style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #fff; width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">üìÑ</span>
                        Contract Details (Optional)
                    </h4>
                    <span id="contractToggleIcon" style="color: #f59e0b; font-size: 22px; transition: transform 0.3s ease; font-weight: 700;">‚ñº</span>
                </div>
                <div id="contractSection" style="display: none; padding: 0 20px 20px 20px; border-top: 2px solid rgba(245, 158, 11, 0.1);">
                    <div class="form-grid" style="display:grid; grid-template-columns: repeat(2, 1fr); gap: 18px; margin-top: 16px;">
                        <div>
                            <label for="contract_start_date" style="display:block;margin-bottom:8px;font-weight:700;color:#cbd5e1;font-size:13px;text-transform:uppercase;letter-spacing:0.5px;">Contract Start Date</label>
                            <input type="date" id="contract_start_date" name="contract_start_date" style="width: 100%; padding: 12px 14px; border-radius: 10px; border: 2px solid rgba(245, 158, 11, 0.2); background: rgba(30, 41, 59, 0.6); color: #cbd5e1; font-size: 14px; transition: all 0.3s ease; cursor: pointer;" onfocus="this.style.borderColor='rgba(245, 158, 11, 0.5)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='0 0 12px rgba(245, 158, 11, 0.2)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(245, 158, 11, 0.2)'; this.style.background='rgba(30, 41, 59, 0.6)'; this.style.boxShadow='none'">
                        </div>
                        <div>
                            <label for="contract_end_date" style="display:block;margin-bottom:8px;font-weight:700;color:#cbd5e1;font-size:13px;text-transform:uppercase;letter-spacing:0.5px;">Contract End Date</label>
                            <input type="date" id="contract_end_date" name="contract_end_date" style="width: 100%; padding: 12px 14px; border-radius: 10px; border: 2px solid rgba(245, 158, 11, 0.2); background: rgba(30, 41, 59, 0.6); color: #cbd5e1; font-size: 14px; transition: all 0.3s ease; cursor: pointer;" onfocus="this.style.borderColor='rgba(245, 158, 11, 0.5)'; this.style.background='rgba(30, 41, 59, 0.8)'; this.style.boxShadow='0 0 12px rgba(245, 158, 11, 0.2)'; this.style.color='#fff'" onblur="this.style.borderColor='rgba(245, 158, 11, 0.2)'; this.style.background='rgba(30, 41, 59, 0.6)'; this.style.boxShadow='none'">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Document Upload (Optional) -->
            <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(59, 130, 246, 0.02) 100%); border: 2px solid rgba(59, 130, 246, 0.18); border-left: 6px solid #3b82f6; padding: 28px; border-radius: 16px; margin-bottom: 36px; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.06);">
                <h4 style="margin: 0 0 28px 0; color: #3b82f6; font-size: 20px; font-weight: 800; display: flex; align-items: center; gap: 14px; letter-spacing: 0.3px;">
                    <span style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: #fff; width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);">üìé</span>
                    Document Upload (Optional)
                </h4>
                <div class="form-grid" style="display:grid; grid-template-columns: repeat(3, 1fr); gap: 18px;">
                    <div style="position: relative; border: 2px dashed rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; text-align: center; background: rgba(59, 130, 246, 0.05); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.borderColor='rgba(59, 130, 246, 0.6)'; this.style.background='rgba(59, 130, 246, 0.1)'" onmouseout="this.style.borderColor='rgba(59, 130, 246, 0.3)'; this.style.background='rgba(59, 130, 246, 0.05)'">
                        <input type="file" id="quotation_pdf" name="quotation_pdf" accept=".pdf" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; cursor: pointer; opacity: 0;">
                        <div style="pointer-events: none;">
                            <span style="font-size: 32px; display: block; margin-bottom: 8px;">üìÑ</span>
                            <label for="quotation_pdf" style="display:block;font-weight:700;color:#3b82f6;font-size:13px;margin-bottom:4px;cursor: pointer;">Quotation PDF</label>
                            <small style="color: #94a3b8; font-size: 11px;">Drop file or click to select</small>
                        </div>
                    </div>
                    <div style="position: relative; border: 2px dashed rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; text-align: center; background: rgba(59, 130, 246, 0.05); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.borderColor='rgba(59, 130, 246, 0.6)'; this.style.background='rgba(59, 130, 246, 0.1)'" onmouseout="this.style.borderColor='rgba(59, 130, 246, 0.3)'; this.style.background='rgba(59, 130, 246, 0.05)'">
                        <input type="file" id="agreement_pdf" name="agreement_pdf" accept=".pdf" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; cursor: pointer; opacity: 0;">
                        <div style="pointer-events: none;">
                            <span style="font-size: 32px; display: block; margin-bottom: 8px;">üìã</span>
                            <label for="agreement_pdf" style="display:block;font-weight:700;color:#3b82f6;font-size:13px;margin-bottom:4px;cursor: pointer;">Agreement / Contract</label>
                            <small style="color: #94a3b8; font-size: 11px;">Drop file or click to select</small>
                        </div>
                    </div>
                    <div style="position: relative; border: 2px dashed rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; text-align: center; background: rgba(59, 130, 246, 0.05); transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.borderColor='rgba(59, 130, 246, 0.6)'; this.style.background='rgba(59, 130, 246, 0.1)'" onmouseout="this.style.borderColor='rgba(59, 130, 246, 0.3)'; this.style.background='rgba(59, 130, 246, 0.05)'">
                        <input type="file" id="gst_certificate" name="gst_certificate" accept=".pdf,.jpg,.jpeg,.png" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; cursor: pointer; opacity: 0;">
                        <div style="pointer-events: none;">
                            <span style="font-size: 32px; display: block; margin-bottom: 8px;">üèõÔ∏è</span>
                            <label for="gst_certificate" style="display:block;font-weight:700;color:#3b82f6;font-size:13px;margin-bottom:4px;cursor: pointer;">GST Certificate</label>
                            <small style="color: #94a3b8; font-size: 11px;">Drop file or click to select</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Info Note -->
            <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.12) 0%, rgba(59, 130, 246, 0.04) 100%); border: 2px solid rgba(59, 130, 246, 0.3); border-left: 6px solid #3b82f6; border-radius: 14px; padding: 20px 22px; margin-bottom: 36px; display: flex; gap: 16px; align-items: flex-start; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.08);">
                <span style="font-size: 28px; flex-shrink: 0; margin-top: 0px; filter: drop-shadow(0 2px 4px rgba(59, 130, 246, 0.2));">üí°</span>
                <div style="flex: 1;">
                    <p style="margin: 0; color: #cbd5e1; font-size: 13px; line-height: 1.8; font-weight: 500;">
                        <strong style="color: #60a5fa; font-weight: 800; display: block; margin-bottom: 8px; font-size: 14px;">üìå Quick Tips:</strong>
                        <span style="display: block; margin-bottom: 6px; color: #e2e8f0;">‚úì One vendor can supply multiple materials with different rates</span>
                        <span style="display: block; margin-bottom: 6px; color: #e2e8f0;">‚úì Pricing is vendor-material specific and never changes master data</span>
                        <span style="display: block; color: #e2e8f0;">‚úì Vendor priority helps with automated purchase suggestions</span>
                    </p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div style="display:flex;gap:12px;justify-content:flex-end;padding:24px 40px;margin:40px -40px -40px -40px;background:linear-gradient(180deg,transparent 0%,rgba(255, 255, 255, 0.95) 60%,rgba(255, 255, 255, 0.98) 100%);border-top:2px solid var(--border-color);border-radius:0 0 12px 12px; box-shadow: 0 -4px 12px rgba(0,0,0,0.05);">
                <button type="button" onclick="closeAddVendorModal()" style="display:flex;align-items:center;gap:8px;padding:10px 24px;font-size:14px;font-weight:600; background: rgba(100, 116, 139, 0.1); border: 1.5px solid rgba(100, 116, 139, 0.2); border-radius: 8px; color: var(--text-primary); cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(100, 116, 139, 0.15)'; this.style.borderColor='rgba(100, 116, 139, 0.3)'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(100, 116, 139, 0.15)'" onmouseout="this.style.background='rgba(100, 116, 139, 0.1)'; this.style.borderColor='rgba(100, 116, 139, 0.2)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'" title="Cancel and discard changes">
                    <span>‚úï</span>
                    <span>Cancel</span>
                </button>
                <button type="submit" style="display:flex;align-items:center;gap:8px;padding:10px 24px;font-size:14px;font-weight:600; background: linear-gradient(135deg, #4f8cff 0%, #3a6fd8 100%); border: none; border-radius: 8px; color: #fff; cursor: pointer; box-shadow: 0 4px 15px rgba(79, 140, 255, 0.4), 0 0 20px rgba(79, 140, 255, 0.15); transition: all 0.3s ease;" onmouseover="this.style.boxShadow='0 6px 25px rgba(79, 140, 255, 0.5), 0 0 30px rgba(79, 140, 255, 0.25)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='0 4px 15px rgba(79, 140, 255, 0.4), 0 0 20px rgba(79, 140, 255, 0.15)'; this.style.transform='translateY(0)'" title="Submit and add vendor to the system">
                    <span>‚úì</span>
                    <span>Add Vendor</span>
                </button>
            </div>
        </form>
        </div>
    </div>
</div>

{% endblock %}

