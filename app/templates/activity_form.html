{% extends "base.html" %}
{% block content %}

<h1 class="page-title">
    Add Activity – {{ project.name }}
</h1>

<div class="card card--sm card-pad">

<form method="post" action="/projects/{{ project.id }}/activities/create">

    <!-- SUGGESTED ACTIVITIES (BY PROJECT CLASSIFICATION) -->
    {% if suggested_activities and suggested_activities|length %}
    <div class="form-group">
        <label>Pick from presets (optional)</label>
        <select id="activitySuggestion">
            <option value="">-- Select a standard activity --</option>
            {% for a in suggested_activities %}
                <option value="{{ a }}">{{ a }}</option>
            {% endfor %}
        </select>
        <small style="opacity:0.7">Selecting a preset will auto-fill the name and mark it as standard.</small>
    </div>
    {% endif %}

    <!-- ACTIVITY NAME -->
    <div class="form-group">
        <label>Activity Name</label>
        <input
            type="text"
            name="name"
            id="activityName"
            placeholder="Earthwork / WMM / DBM / Custom"
            required
        >
    </div>

    <!-- STANDARD / CUSTOM -->
    <div class="form-group">
        <label style="display:flex;align-items:center;gap:8px">
            <input type="checkbox" name="is_standard" id="isStandard">
            Standard Activity
        </label>
        <small style="opacity:0.7">
            Check for standard activities like Earthwork, WMM, DBM
        </small>
    </div>

    <div class="form-group" style="margin-top:18px">
        <label style="font-weight:700">DPR Planning (required)</label>
        <small style="opacity:0.7;display:block;margin-top:4px">This creates the DPR plan immediately.</small>
    </div>

    <div class="form-group">
        <label>Planned Quantity</label>
        <input type="number" name="planned_quantity" step="0.01" min="0" required>
    </div>

    <div class="form-group">
        <label>Unit</label>
        <input type="text" name="unit" placeholder="m3 / sqm / m / km / nos" required>
    </div>

    <div class="form-group">
        <label>Start Date</label>
        <input type="text" name="start_date" placeholder="DD/MM/YYYY" inputmode="numeric" pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required>
    </div>

    <div class="form-group">
        <label>End Date</label>
        <input type="text" name="end_date" placeholder="DD/MM/YYYY" inputmode="numeric" pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required>
    </div>

    <div class="form-group">
        <label>Planned Time (optional)</label>
        <input type="number" name="planned_time_display" step="0.001" min="0" placeholder="Leave empty if not tracking time">
    </div>

    <div class="form-group">
        <label>Time Unit</label>
        <select name="display_unit">
            <option value="hours">Hours (hrs)</option>
            <option value="days">Days</option>
        </select>
    </div>

    <div class="form-group">
        <label>Hours per Day</label>
        <input type="number" name="hours_per_day" step="0.1" min="0.1" value="8">
    </div>

    <!-- ACTIONS -->
    <div style="margin-top:20px;display:flex;gap:12px">
        <button class="btn-primary" type="submit">
            ➕ Create Activity
        </button>

        <a href="/projects/{{ project.id }}/activities" class="btn-secondary">
            Cancel
        </a>
    </div>

</form>

<script>
(function(){
    var sel = document.getElementById('activitySuggestion');
    var name = document.getElementById('activityName');
    var std = document.getElementById('isStandard');
    if(!sel || !name || !std) return;
    sel.addEventListener('change', function(){
        if(!sel.value) return;
        name.value = sel.value;
        std.checked = true;
    });
})();
</script>

</div>

{% endblock %}
