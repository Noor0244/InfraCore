{% extends "base.html" %}
{% block content %}

<div class="page-header"
     style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px">

    <h1 class="page-title">Project Activities ‚Äî {{ project.name }}</h1>

    <div style="display:flex;gap:10px;flex-wrap:wrap">
        <!-- üîπ ADD ACTIVITY -->
        {% if project_role in ["admin", "manager"] %}
        <a href="/projects/{{ project.id }}/activities/new" class="btn-primary">
            ‚ûï Add Activity
        </a>
        {% endif %}

        <!-- üîπ PLAN ACTIVITIES -->
        {% if project_role in ["admin", "manager"] %}
        <a href="/activity-material-planning/{{ project.id }}" class="btn-info">
            üóìüß± Activity & Materials
        </a>
        {% endif %}

        <a href="/dashboard?project_id={{ project.id }}" class="btn-secondary">
            ‚Üê Back to Dashboard
        </a>
    </div>
</div>

<div class="card" style="margin-bottom:20px">
    <strong>Project:</strong> {{ project.name }}<br>
    <strong>Location:</strong>
    {{ project.city }}
    {% if project.state %}, {{ project.state }}{% endif %}
</div>

<div class="card" style="padding:0">
<table class="table" style="margin:0">
<thead>
<tr>
    <th>Activity</th>
    <th>Planned Qty</th>
    <th>Unit</th>
    <th>Start</th>
    <th>End</th>
    <th>Daily Execution</th>
</tr>
</thead>

<tbody>
{% for pa in activities %}
<tr>

    <!-- ACTIVITY -->
    <td>
        <strong>{{ pa.activity.name if pa.activity else "Activity #" ~ pa.activity_id }}</strong>
    </td>

    <td>{{ pa.planned_quantity }}</td>
    <td>{{ pa.unit }}</td>
    <td>{{ pa.start_date|ddmmyyyy }}</td>
    <td>{{ pa.end_date|ddmmyyyy }}</td>

    <!-- DAILY EXECUTION -->
    <td>
        {% if project_role in ["admin", "manager", "member"] %}
        <form
            method="post"
            action="/daily-entry"
            style="display:flex;gap:6px;align-items:center;flex-wrap:wrap"
        >
            <input type="hidden" name="project_id" value="{{ project.id }}">
            <input type="hidden" name="activity_id" value="{{ pa.activity_id }}">

            <input
                type="number"
                step="0.01"
                name="quantity_done"
                placeholder="Qty"
                required
                style="width:90px"
            >

            <input
                type="text"
                name="entry_date"
                placeholder="DD/MM/YYYY"
                inputmode="numeric"
                pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}"
                required
            >

            <button class="btn-success btn-sm" type="submit">
                ‚ûï Add
            </button>
        </form>
        {% else %}
            <span class="badge badge-info">View Only</span>
        {% endif %}
    </td>

</tr>
{% else %}
<tr>
    <td colspan="6" style="text-align:center;opacity:0.7">
        No activities planned for this project.
    </td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

{% endblock %}
