{% extends "base.html" %}
{% block content %}
<style>
    .card {
        background: #181c24;
        border-radius: 16px;
        box-shadow: 0 4px 24px 0 rgba(0,0,0,0.13), 0 1.5px 6px 0 rgba(0,0,0,0.10);
        margin-bottom: 28px;
        padding: 0 0 18px 0;
        overflow: hidden;
    }
    .page-header {
        background: none;
        border-bottom: 1.5px solid rgba(255,255,255,0.07);
        margin-bottom: 28px;
        padding-bottom: 10px;
    }
    .page-title {
        font-size: 2.1rem;
        <link rel="stylesheet" href="/static/css/user_management.css">
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    .card .table td .badge {
        margin-bottom: 0;
    }
    @media (max-width: 900px) {
        .page-header, .card { padding-left: 2vw; padding-right: 2vw; }
        .table th, .table td { font-size: 0.97em; }
        .page-title { font-size: 1.3rem; }
    }
</style>

<div class="page-header"
     style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">

    <h1 class="page-title">User Management</h1>

    <div style="display:flex;gap:10px;flex-wrap:wrap">
        <a href="/admin/logs"
           style="
               background:#374151;
               color:#ffffff;
               padding:8px 14px;
               border-radius:6px;
               font-weight:600;
               text-decoration:none;
               display:inline-flex;
               align-items:center;
               gap:6px;
           ">
            üßæ Audit Logs
        </a>

        <a href="/admin/presets/road"
           style="
               background:#374151;
               color:#ffffff;
               padding:8px 14px;
               border-radius:6px;
               font-weight:600;
               text-decoration:none;
               display:inline-flex;
               align-items:center;
               gap:6px;
           ">
            üß© Road Presets
        </a>

        <!-- ADD USER -->
        <a href="/admin/users/new"
           style="
               background:#1f6feb;
               color:#ffffff;
               padding:8px 14px;
               border-radius:6px;
               font-weight:600;
               text-decoration:none;
               display:inline-flex;
               align-items:center;
               gap:6px;
           ">
            ‚ûï Add User
        </a>
    </div>
</div>

<div class="card" style="padding:0;margin-bottom:18px">

    <div style="padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.08)">
        <h3 style="margin:0">Super Admins</h3>
    </div>

    <table class="table" style="margin:0">
        <thead>
            <tr style="background:rgba(255,255,255,0.04)">
                <th style="width:60px">ID</th>
                <th>Username</th>
                <th style="width:120px">Role</th>
                <th style="width:120px">Status</th>
                <th style="width:320px">Actions</th>
            </tr>
        </thead>
        <tbody>
        {% if superadmins and superadmins|length > 0 %}
        {% for u in superadmins %}
            <tr style="border-bottom:1px solid rgba(255,255,255,0.05)">
                <td>{{ u.id }}</td>
                <td><strong>{{ u.username }}</strong></td>
                <td><span class="badge badge-info">{{ u.role | upper }}</span></td>
                <td>
                    {% if u.is_active %}
                        <span class="badge badge-success">ACTIVE</span>
                    {% else %}
                        <span class="badge badge-danger">DISABLED</span>
                    {% endif %}
                </td>
                <td>
                    <div style="display:flex;gap:8px;flex-wrap:wrap">
                        <a href="/admin/users/{{ u.id }}/edit" style="background:#374151;color:#ffffff;padding:5px 10px;border-radius:5px;font-size:13px;text-decoration:none;">‚úèÔ∏è Edit</a>
                        <a href="/admin/users/{{ u.id }}/sessions" style="background:#0ea5a4;color:#ffffff;padding:5px 10px;border-radius:5px;font-size:13px;text-decoration:none;">üïí Sessions</a>
                        {% if user["id"] != u.id %}
                            <form method="post" action="/admin/users/{{ u.id }}/toggle" style="display:inline">
                                {% if u.is_active %}
                                    <button type="submit" style="background:#dc2626;color:#ffffff;padding:5px 10px;border:none;border-radius:5px;font-size:13px;cursor:pointer;">üö´ Disable</button>
                                {% else %}
                                    <button type="submit" style="background:#16a34a;color:#ffffff;padding:5px 10px;border:none;border-radius:5px;font-size:13px;cursor:pointer;">‚úÖ Enable</button>
                                {% endif %}
                            </form>
                            {% if user["role"] == "superadmin" %}
                            <form method="post" action="/admin/users/{{ u.id }}/delete" style="display:inline" onsubmit="return confirm('Delete this user permanently? This cannot be undone.')">
                                <button type="submit" style="background:#b91c1c;color:#ffffff;padding:5px 10px;border:none;border-radius:5px;font-size:13px;cursor:pointer;">üóë Delete</button>
                            </form>
                            {% endif %}
                        {% else %}
                            <span class="badge badge-warning">You</span>
                        {% endif %}
                    </div>
                </td>
            </tr>
        {% endfor %}
        {% else %}
            <tr>
                <td colspan="5" style="text-align:center;padding:24px">
                    <strong>No super admins found.</strong>
                </td>
            </tr>
        {% endif %}
        </tbody>
    </table>
</div>

<div class="card" style="padding:0;margin-bottom:18px">
    <div style="padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.08)">
        <h3 style="margin:0">Project Users</h3>
    </div>
    {% if user["role"] == "superadmin" %}
        <script>
        function toggleProjectUsers(pid) {
            var tbl = document.getElementById('project-users-' + pid);
            var btn = document.getElementById('toggle-btn-' + pid);
            if (!tbl || !btn) return;
            if (tbl.style.display === 'none' || tbl.classList.contains('hidden')) {
                tbl.style.display = '';
                tbl.classList.remove('hidden');
                btn.innerText = 'Hide';
            } else {
                tbl.style.display = 'none';
                tbl.classList.add('hidden');
                btn.innerText = 'Show';
            }
        }
                const projectIds = JSON.parse('{{ projects | map(attribute="id") | list | tojson }}');
                window.addEventListener('DOMContentLoaded', function() {
                    projectIds.forEach(function(pid) {
                        var tbl = document.getElementById('project-users-' + pid);
                        var btn = document.getElementById('toggle-btn-' + pid);
                        if (tbl && btn) {
                            tbl.style.display = 'none';
                            btn.innerText = 'Show';
                        }
                    });
                });
        </script>
        {% for project in projects %}
            <div style="display:flex;align-items:center;gap:12px;padding:10px 20px;background:rgba(31,111,235,0.08);margin-bottom:4px;border-radius:6px">
                <span style="font-weight:600;color:#1f6feb;flex:1">{{ project.name }}</span>
                <button id="toggle-btn-{{ project.id }}" type="button" onclick="toggleProjectUsers({{ project.id }})" style="background:#1f6feb;color:#fff;border:none;padding:4px 16px;border-radius:5px;cursor:pointer;font-weight:500;">Show</button>
            </div>
            <table id="project-users-{{ project.id }}" class="table hidden" style="margin:0 0 18px 0">
                <thead>
                    <tr style="background:rgba(255,255,255,0.04)">
                        <th style="width:60px">ID</th>
                        <th>Username</th>
                        <th style="width:120px">Role</th>
                        <th style="width:120px">Status</th>
                        <th style="width:320px">Actions</th>
                    </tr>
                </thead>
                <tbody>
                {% for u in project.users %}
                    <tr style="border-bottom:1px solid rgba(255,255,255,0.05)">
                        <td>{{ u.id }}</td>
                        <td><strong>{{ u.username }}</strong></td>
                        <td><span class="badge badge-info">{{ u.role | upper }}</span></td>
                        <td>
                            {% if u.is_active %}
                                <span class="badge badge-success">ACTIVE</span>
                            {% else %}
                                <span class="badge badge-danger">DISABLED</span>
                            {% endif %}
                        </td>
                        <td>
                            <div style="display:flex;gap:8px;flex-wrap:wrap">
                                <a href="/admin/users/{{ u.id }}/edit" style="background:#374151;color:#ffffff;padding:5px 10px;border-radius:5px;font-size:13px;text-decoration:none;">‚úèÔ∏è Edit</a>
                                <a href="/admin/users/{{ u.id }}/sessions" style="background:#0ea5a4;color:#ffffff;padding:5px 10px;border-radius:5px;font-size:13px;text-decoration:none;">üïí Sessions</a>
                                {% if user["id"] != u.id %}
                                    <form method="post" action="/admin/users/{{ u.id }}/toggle" style="display:inline">
                                        {% if u.is_active %}
                                            <button type="submit" style="background:#dc2626;color:#ffffff;padding:5px 10px;border:none;border-radius:5px;font-size:13px;cursor:pointer;">üö´ Disable</button>
                                        {% else %}
                                            <button type="submit" style="background:#16a34a;color:#ffffff;padding:5px 10px;border:none;border-radius:5px;font-size:13px;cursor:pointer;">‚úÖ Enable</button>
                                        {% endif %}
                                    </form>
                                    <form method="post" action="/admin/users/{{ u.id }}/delete" style="display:inline" onsubmit="return confirm('Delete this user permanently? This cannot be undone.')">
                                        <button type="submit" style="background:#b91c1c;color:#ffffff;padding:5px 10px;border:none;border-radius:5px;font-size:13px;cursor:pointer;">üóë Delete</button>
                                    </form>
                                {% else %}
                                    <span class="badge badge-warning">You</span>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endfor %}
    {% else %}
        <table class="table" style="margin:0">
            <thead>
                <tr style="background:rgba(255,255,255,0.04)">
                    <th style="width:60px">ID</th>
                    <th>Username</th>
                    <th>Project Name</th>
                    <th style="width:120px">Role</th>
                    <th style="width:120px">Status</th>
                    <th style="width:320px">Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for u in project_users %}
                <tr style="border-bottom:1px solid rgba(255,255,255,0.05)">
                    <td>{{ u.id }}</td>
                    <td><strong>{{ u.username }}</strong></td>
                    <td>{{ u.project_name }}</td>
                    <td><span class="badge badge-info">{{ u.role | upper }}</span></td>
                    <td>
                        {% if u.is_active %}
                            <span class="badge badge-success">ACTIVE</span>
                        {% else %}
                            <span class="badge badge-danger">DISABLED</span>
                        {% endif %}
                    </td>
                    <td>
                        <div style="display:flex;gap:8px;flex-wrap:wrap">
                            <a href="/admin/users/{{ u.id }}/edit" style="background:#374151;color:#ffffff;padding:5px 10px;border-radius:5px;font-size:13px;text-decoration:none;">‚úèÔ∏è Edit</a>
                            <a href="/admin/users/{{ u.id }}/sessions" style="background:#0ea5a4;color:#ffffff;padding:5px 10px;border-radius:5px;font-size:13px;text-decoration:none;">üïí Sessions</a>
                            {% if user["id"] != u.id %}
                                <form method="post" action="/admin/users/{{ u.id }}/toggle" style="display:inline">
                                    {% if u.is_active %}
                                        <button type="submit" style="background:#dc2626;color:#ffffff;padding:5px 10px;border:none;border-radius:5px;font-size:13px;cursor:pointer;">üö´ Disable</button>
                                    {% else %}
                                        <button type="submit" style="background:#16a34a;color:#ffffff;padding:5px 10px;border:none;border-radius:5px;font-size:13px;cursor:pointer;">‚úÖ Enable</button>
                                    {% endif %}
                                </form>
                            {% else %}
                                <span class="badge badge-warning">You</span>
                            {% endif %}
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% endif %}
</div>

<div class="card" style="padding:0">
    <div style="padding:16px 20px;border-bottom:1px solid rgba(255,255,255,0.08)">
        <h3 style="margin:0">Unassigned Users</h3>
        <div class="help-text" style="margin-top:6px">Users not connected to any project.</div>
    </div>
    <table class="table" style="margin:0">
        <thead>
            <tr style="background:rgba(255,255,255,0.04)">
                <th style="width:60px">ID</th>
                <th>Username</th>
                <th style="width:120px">Role</th>
                <th style="width:120px">Status</th>
                <th style="width:320px">Actions</th>
            </tr>
        </thead>
        <tbody>
        {% if unassigned_users and unassigned_users|length > 0 %}
        {% for u in unassigned_users %}
            <tr style="border-bottom:1px solid rgba(255,255,255,0.05)">
                <td>{{ u.id }}</td>
                <td><strong>{{ u.username }}</strong></td>
                <td><span class="badge badge-info">{{ u.role | upper }}</span></td>
                <td>
                    {% if u.is_active %}
                        <span class="badge badge-success">ACTIVE</span>
                    {% else %}
                        <span class="badge badge-danger">DISABLED</span>
                    {% endif %}
                </td>
                <td>
                    <div style="display:flex;gap:8px;flex-wrap:wrap">
                        <a href="/admin/users/{{ u.id }}/edit" style="background:#374151;color:#ffffff;padding:5px 10px;border-radius:5px;font-size:13px;text-decoration:none;">‚úèÔ∏è Edit</a>
                        <a href="/admin/users/{{ u.id }}/sessions" style="background:#0ea5a4;color:#ffffff;padding:5px 10px;border-radius:5px;font-size:13px;text-decoration:none;">üïí Sessions</a>
                        {% if user["id"] != u.id %}
                            <form method="post" action="/admin/users/{{ u.id }}/toggle" style="display:inline">
                                {% if u.is_active %}
                                    <button type="submit" style="background:#dc2626;color:#ffffff;padding:5px 10px;border:none;border-radius:5px;font-size:13px;cursor:pointer;">üö´ Disable</button>
                                {% else %}
                                    <button type="submit" style="background:#16a34a;color:#ffffff;padding:5px 10px;border:none;border-radius:5px;font-size:13px;cursor:pointer;">‚úÖ Enable</button>
                                {% endif %}
                            </form>
                            {% if user["role"] == "superadmin" %}
                            <form method="post" action="/admin/users/{{ u.id }}/delete" style="display:inline" onsubmit="return confirm('Delete this user permanently? This cannot be undone.')">
                                <button type="submit" style="background:#b91c1c;color:#ffffff;padding:5px 10px;border:none;border-radius:5px;font-size:13px;cursor:pointer;">üóë Delete</button>
                            </form>
                            {% endif %}
                        {% else %}
                            <span class="badge badge-warning">You</span>
                        {% endif %}
                    </div>
                </td>
            </tr>
        {% endfor %}
        {% else %}
            <tr>
                <td colspan="5" style="text-align:center;padding:24px">
                    <strong>No unassigned users.</strong>
                </td>
            </tr>
        {% endif %}
        </tbody>
    </table>
</div>

{% endblock %}
